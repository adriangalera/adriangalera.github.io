<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.3
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    <!-- Theme Mode-->
    
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/img/avatars/me-100x100.png" type="image/x-icon">

    

    <!-- KaTeX 0.15.2 -->
    
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    <!-- Mermaid 9.1.1 -->
    
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({
      startOnLoad:true,
      theme: 'default',
    });"></script>
    

    <!-- Simple Jekyll Search 1.10.0 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://www.agalera.eu';
      const isCookieConsent = 'false';
      const analyticsName = 'UA-126206451-1';
      const analyticsNameGA4 = '';
    </script>

    
    
        <!-- old google analytics -->
        <!--
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-126206451-1"></script>
        <script async src='https://www.google-analytics.com/analytics.js'></script>
        <script>
        // disable GA for localhost
        const isProduction = window.location.host.includes("agalera.eu")
        if (!isProduction) { 
          console.log(`Disabling google analytics for UA-126206451-1`)
          window['ga-disable-UA-126206451-1'] = true;
        }
        </script>
        -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-S8VGYBN25C');
        </script>        
    

    <!-- seo tags -->
    <meta property="og:image" content="https://www.agalera.eu/assets/img/posts/browser-storage/featured-image.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Browser storage | Adrian Galera blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Browser storage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to store data in browser in order to make standalone apps without backend. This articles explores using browser localstorage and caches." />
<meta property="og:description" content="How to store data in browser in order to make standalone apps without backend. This articles explores using browser localstorage and caches." />
<link rel="canonical" href="https://www.agalera.eu/browser-storage/" />
<meta property="og:url" content="https://www.agalera.eu/browser-storage/" />
<meta property="og:site_name" content="Adrian Galera blog" />
<meta property="og:image" content="https://www.agalera.eu/assets/img/posts/browser-storage/featured-image.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-23T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.agalera.eu/assets/img/posts/browser-storage/featured-image.jpg" />
<meta property="twitter:title" content="Browser storage" />
<script type="application/ld+json">
{"url":"https://www.agalera.eu/browser-storage/","@type":"BlogPosting","image":"https://www.agalera.eu/assets/img/posts/browser-storage/featured-image.jpg","description":"How to store data in browser in order to make standalone apps without backend. This articles explores using browser localstorage and caches.","dateModified":"2022-07-23T00:00:00+02:00","datePublished":"2022-07-23T00:00:00+02:00","headline":"Browser storage","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.agalera.eu/browser-storage/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Adrian Galera blog" href="https://www.agalera.eu/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://www.agalera.eu/feed.xml" title="Adrian Galera blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Browser storage">
    <meta name="twitter:description" content="In this article I discuss some techniques to store data in the browser. This way the web applications do not require a expensive backend, every customer stor...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://www.agalera.eu/assets/img/posts/browser-storage/featured-image.jpg">
    <meta name="twitter:image:alt" content="Browser storage">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/assets/img/avatars/me-100x100.png" />
		</a>
        
        <a class="site-title" aria-label="Adrian Galera blog" href="/">
        Adrian Galera blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Browser storage " aria-label="Browser storage" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Browser+storage" class="title">Browser storage</h1>
      


<div class="post-info">
    <p class="meta">
      
      
      July 23, 2022
    </p></div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>In this article I discuss some techniques to store data in the browser. This way the web applications do not require a expensive backend, every customer stores its information in the browser.</p>

<p><!--more--></p>

<p>This is part of my series of articles about leaflet:</p>

<ul>
  <li><a href="/leaflet-fog-of-war">Leaflet fog of war</a></li>
  <li><a href="/leaflet-draw-polygon-markers">Draw a polygon from markers in leaflet</a></li>
  <li><a href="/leaflet-load-gpx">Load and display GPX in leaflet</a></li>
  <li><a href="/browser-storage">Browser storage</a></li>
</ul>

<p>For the implementation of fog of war map, I do not want to spend any time dealing with the backend. Besides that, I don’t want to spent not even a cent on the storage of data.</p>

<p>In this scenario, the visited areas are stored into a huge GeoJSON document. The persistence should store that document so the user does not need to re-create it every time.</p>

<p>However, how the can the data be persisted without any backend? It turns out the browser offers some persistence capabilities, let’s analyse them.</p>

<h2 id="local-storage">Local storage</h2>

<p>The first approach is to use browser’s local storage. This storage is a key-value storage which has a very simple synchronous contract:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span>
<span class="o">&gt;</span> <span class="nx">Storage</span><span class="err"> </span><span class="p">{</span><span class="nl">a</span><span class="p">:</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="nx">length</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span>
</code></pre></div></div>

<p>This storage is really simple and easy to use, however it comes at the cost of have a very limited space in the order of few MBs.</p>

<p>The original approach was to use this type of storage, however I reached the size limit really fast when I started to import GPX files.</p>

<h2 id="caches">Caches</h2>

<p>Reading a little bit more on browser storage capabilities, I discovered the caching mechanism. This is designed to store the answers from HTTP calls, hence its name. However, its original purpose can be violated to store any kind of data, not only HTTP responses.</p>

<p>This new API is asynchronous, that make the transition from local storage to caches a little bit painful, but it’s a price we have to pay for having a massive amount of storage capability. According to <a href="https://web.dev/cache-api-quick-guide/">this article</a> the storage availability is based on the amount of storage available on the disk.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">GeoJsonStorage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">CACHE_NAME</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">geojson</span><span class="dl">"</span>
    <span class="kd">const</span> <span class="nx">CACHE_KEY</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://xxxx/geojson.json</span><span class="dl">"</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">set</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">geojson</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">CACHE_NAME</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">CACHE_KEY</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">geojson</span><span class="p">)));</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Cannot open the cache, error: </span><span class="p">${</span><span class="nx">err</span><span class="p">}</span><span class="s2">`</span><span class="p">))</span>
        <span class="p">},</span>

        <span class="na">get</span><span class="p">:</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">CACHE_NAME</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">cache</span> <span class="o">=&gt;</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">CACHE_KEY</span><span class="p">))</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">undefined</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Cannot get the contents from the cache, error: </span><span class="p">${</span><span class="nx">err</span><span class="p">}</span><span class="s2">`</span><span class="p">))</span>
        <span class="p">},</span>
        <span class="na">clear</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">caches</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">CACHE_NAME</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>The key to store arbitrary data into the caches mechanism is to trick the system saying that the cache key is an HTTP request: <code class="language-plaintext highlighter-rouge">https://xxxx/geojson.json</code>. This way, you can put and retrieve a JSON inside the caching mechanism</p>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
        
        <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.agalera.eu/browser-storage/" target="_blank"
               title=" Facebook">
                <i class="fab fa-facebook-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Facebook</span>
            </a>
        </li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Browser+storage%20https%3A%2F%2Fwww.agalera.eu%2Fbrowser-storage%2F"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
         
        <li>
            <a href="https://www.tumblr.com/share?v=3&u=https://www.agalera.eu/browser-storage/&quote=Browser+storage%20%7C%20Adrian+Galera+blog&s="
               target="_blank" title=" Tumblr">
                <i class="fab fa-tumblr-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Tumblr</span>
            </a>
        </li>
         
        <li>
            <a href="https://pinterest.com/pin/create/button/?url=https://www.agalera.eu/browser-storage/&media=https://www.agalera.eu/assets/img/posts/browser-storage/featured-image.jpg$description=In+this+article+I+discuss+some+techniques+to+store+data+in+the+browser.+This+way+the+web+applications+do+not+require+a+expensive+backend%2C+every+customer+stores+its+information+in+the+browser.%0A%0A%0A%0A"
               target="_blank" title="">
                <i class="fab fa-pinterest-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Pin it</span>
            </a>
        </li>
          
        <li>
            <a href="https://www.reddit.com/submit?url=https://www.agalera.eu/browser-storage/&title=Browser+storage%20%7C%20Adrian+Galera+blog"
               target="_blank" title=" Reddit">
                <i class="fab fa-reddit-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Reddit</span>
            </a>
        </li>
         
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.agalera.eu/browser-storage/&title=Browser+storage%20%7C%20Adrian+Galera+blog&summary=&source=https://www.agalera.eu/browser-storage/"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Browser storage%20%7C%20Adrian Galera blog&body=https://www.agalera.eu/browser-storage/"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#browser">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> browser</p>
        </a></li>
      
        <li><a class="button" href="/tags#javascript">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> javascript</p>
        </a></li>
      
        <li><a class="button" href="/tags#persistence">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> persistence</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Password protection for Github Pages" href="/github-pages-password/">
            <p>Previous post</p>
            Password protection for Github Pages
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Load GPX in leaflet" href="/leaflet-load-gpx/">
            <p>Next post</p>
            Load GPX in leaflet
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/assets/img/posts/browser-storage/featured-image.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        </p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/adriangalera"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/in/adriangalera"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    
        
        
        
        
        <li>
            <a href="mailto:adrian.galera.87@gmail.com"
               title="Follow on Mail"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


                </ul>
            </div>
</footer>



  </body>
</html>
