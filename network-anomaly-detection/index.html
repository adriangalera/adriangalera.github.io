<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.B3vRBseb.js"></script> <!-- Global Metadata --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <meta name="generator" content="Astro v5.14.1"> <!-- Canonical URL --> <link rel="canonical" href="https://www.agalera.eu/network-anomaly-detection/"> <!-- SEO --> <meta name="title" content="Network anomaly detection • agalera.eu"> <meta name="description" content="Discover how Random Forest classification can be used to spot anomalies in network traffic. This blog post dives into applying machine learning in InfoSec to boost threat detection accuracy and stay ahead of intruders in real time."> <meta name="author" content="Adrian Galera"> <!-- Open Graph / Facebook --> <meta property="og:type" content="article"> <meta property="og:url" content="https://www.agalera.eu/network-anomaly-detection/"> <meta property="og:title" content="Network anomaly detection"> <meta property="og:description" content="Discover how Random Forest classification can be used to spot anomalies in network traffic. This blog post dives into applying machine learning in InfoSec to boost threat detection accuracy and stay ahead of intruders in real time."> <meta property="og:image" content="https://www.agalera.eu/_astro/pexels-mikhail-nilov-6963099.DZltJzg7.jpg">  <meta property="article:author" content="Adrian Galera"> <meta property="article:published_time" content="2025-10-07T00:00:00.000Z">  <!-- Twitter --> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://www.agalera.eu/network-anomaly-detection/"> <meta property="twitter:title" content="Network anomaly detection"> <meta property="twitter:description" content="Discover how Random Forest classification can be used to spot anomalies in network traffic. This blog post dives into applying machine learning in InfoSec to boost threat detection accuracy and stay ahead of intruders in real time."> <meta property="twitter:image" content="https://www.agalera.eu/_astro/pexels-mikhail-nilov-6963099.DZltJzg7.jpg"> <!-- RSS auto-discovery --> <link rel="alternate" type="application/rss+xml" title="agalera.eu" href="/rss.xml"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script> <script type="module">const n=window.location.hostname;n.includes("agalera.eu")||(console.log("Disabling analytics..."),window["ga-disable-G-S8VGYBN25C"]=!0);window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-S8VGYBN25C");</script> <!-- Primary Meta Tags --> <title>Network anomaly detection • agalera.eu</title><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'dark' : 'light')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_slug_.CMnNCk3f.css"></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-8 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-4 md:p-0"> <a href="https://github.com/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://www.linkedin.com/in/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.xPnMudr4.js"></script>  </div> <script type="module">class r extends HTMLElement{constructor(){super();const e=this.querySelector("button");e&&e.addEventListener("click",t=>{if(t.currentTarget instanceof HTMLButtonElement){let n=t.currentTarget.getAttribute("aria-pressed")==="true",s=new CustomEvent("theme-change",{detail:{theme:n?"light":"dark"}});document.dispatchEvent(s),e.setAttribute("aria-pressed",String(!n))}})}}"customElements"in window&&customElements.define("theme-toggle",r);</script> <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header> <script type="module">document.addEventListener("click",e=>{const t=document.getElementById("astro-header-drawer"),n=document.getElementById("astro-header-drawer-button");t?.contains(e.target)||n?.contains(e.target)?t?.classList.toggle("translate-x-96"):t?.classList.add("translate-x-96")});</script>  <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2025-10-07T00:00:00.000Z"> Oct 7, 2025 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 7 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Network anomaly detection </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/python" aria-label="python"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> python </span> </a><a href="/tags/ml" aria-label="ml"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> ml </span> </a><a href="/tags/csv" aria-label="csv"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> csv </span> </a><a href="/tags/networking" aria-label="networking"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> networking </span> </a> </div> </header> <img src="/_astro/pexels-mikhail-nilov-6963099.DZltJzg7_Z14yh15.jpg" loading="eager" alt="img of Network anomaly detection" decoding="async" fetchpriority="auto" width="1000" height="500" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://www.agalera.eu/network-anomaly-detection/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.agalera.eu/network-anomaly-detection/" aria-label="Share on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <h2 class="font-bold mb-3 text-2xl dark:text-white">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#dataset" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Dataset </a>  </li><li class="flex flex-col"> <a href="#random-forest" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Random Forest </a>  </li><li class="flex flex-col"> <a href="#cleaning-and-preparing-the-data" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Cleaning and preparing the data </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#from-category-data-to-binary-data" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> From category data to binary data </a>  </li><li class="flex flex-col"> <a href="#from-category-data-to-integer-data" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> From category data to integer data </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#training-the-model" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Training the model </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>This post continues with the series of articles related with Hack the box academy module about using AI for information security tasks.</p>
<p>This time is about detecting network anomalies using machine learning. Anomaly detection algorithms detect data points that deviate from the norm. This presents an interesting usage in InfoSec, as network traffic deviates from the norm when a cyber attack is ongoing. Therefore, observing anomalies in network traffic is a very good indicator of a cyber attack which can serve the basis as an IDS (Intrusion Detection System).</p>
<h2 id="dataset">Dataset</h2>
<p>For this task, we’ll use the NSL-KDD dataset which is a standard dataset used to measure the performance of various IDS. The dataset contains both attack and normal traffic statistics labelled with attack or normal. It also includes attack types, so it allow our algorithm to perform not just binary classification but also multi-class classification.</p>
<p>The following code downloads and explores the dataset:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> requests</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> zipfile</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># URL for the NSL-KDD dataset</span></span>
<span class="line"><span style="color:#BABED8">url </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">https://academy.hackthebox.com/storage/modules/292/KDD_dataset.zip</span><span style="color:#89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Download the zip file and extract its contents</span></span>
<span class="line"><span style="color:#BABED8">response </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> requests</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">get</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">url</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">z </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> zipfile</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ZipFile</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">io</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">BytesIO</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">response</span><span style="color:#89DDFF">.</span><span style="color:#F07178">content</span><span style="color:#89DDFF">))</span></span>
<span class="line"><span style="color:#BABED8">z</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">extractall</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">.</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span><span style="color:#676E95;font-style:italic">  # Extracts to the current directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> numpy </span><span style="color:#89DDFF;font-style:italic">as</span><span style="color:#BABED8"> np</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> pandas </span><span style="color:#89DDFF;font-style:italic">as</span><span style="color:#BABED8"> pd</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">ensemble </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> RandomForestClassifier</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">model_selection </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> train_test_split</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">metrics </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> accuracy_score</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> precision_score</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> recall_score</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> f1_score</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> confusion_matrix</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> classification_report</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> seaborn </span><span style="color:#89DDFF;font-style:italic">as</span><span style="color:#BABED8"> sns</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> matplotlib</span><span style="color:#89DDFF">.</span><span style="color:#F07178">pyplot</span><span style="color:#89DDFF;font-style:italic"> as</span><span style="color:#BABED8"> plt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Set the file path to the dataset</span></span>
<span class="line"><span style="color:#BABED8">file_path </span><span style="color:#89DDFF">=</span><span style="color:#C792EA"> r</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">KDD</span><span style="color:#89DDFF">+</span><span style="color:#C3E88D">.txt</span><span style="color:#89DDFF">'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Define the column names corresponding to the NSL-KDD dataset</span></span>
<span class="line"><span style="color:#BABED8">columns </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">duration</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">protocol_type</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">service</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">flag</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">src_bytes</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_bytes</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">land</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">wrong_fragment</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">urgent</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">hot</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_failed_logins</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">logged_in</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">num_compromised</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">root_shell</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">su_attempted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_root</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_file_creations</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">num_shells</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_access_files</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_outbound_cmds</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">is_host_login</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">is_guest_login</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">same_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">diff_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_diff_host_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_srv_count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_same_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_diff_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_same_src_port_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_srv_diff_host_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_srv_serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_srv_rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">attack</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">level</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Read the combined NSL-KDD dataset into a DataFrame</span></span>
<span class="line"><span style="color:#BABED8">df </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> pd</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">read_csv</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">file_path</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> names</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">columns</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">())</span></span></code></pre>
<p>As seen, one can define custom names for the columns of the dataset.</p>
<h2 id="random-forest">Random Forest</h2>
<p>To actually perform the classification, we’ll use Random Forest Classifier model. Random Forest are a huge combination of decision trees.</p>
<p>Each layer in the decision tree uses certain feature to decide if the passed input belongs to one class or the other or to pass the input to the next layer. When the input finally arrives to a leaf node the output is the predicted class of the input.</p>
<p>A random forest is build from many decision trees, For each tree, a random subset of features is considered at every split, ensuring diversity and reducing correlations among trees. When the classification is done, each tree votes for a class, and the most voted class wins.</p>
<p>For anomaly detection, the random forest is trained exclusively with normal data. Each data that does not fit the normal data class (or does it with a very low confidence), will be detected as an anomaly.</p>
<h2 id="cleaning-and-preparing-the-data">Cleaning and preparing the data</h2>
<p>As in another machine learning tasks, the models are prepared to work with specific data format, so we need to change our input data to what the model expects.</p>
<h3 id="from-category-data-to-binary-data">From category data to binary data</h3>
<p>Attack or normal labels are text based. We can transform this data to binary:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Maps normal traffic to 0 and any type of attack to 1</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">attack_flag</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">attack</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> a</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 0</span><span style="color:#89DDFF;font-style:italic"> if</span><span style="color:#82AAFF"> a </span><span style="color:#89DDFF">==</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">normal</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF;font-style:italic"> else</span><span style="color:#F78C6C"> 1</span><span style="color:#89DDFF">)</span></span></code></pre>
<p>This can be extended to low cardinality data such as protocol_type(tcp,udp,icmp) or service:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Encoding categorical variables</span></span>
<span class="line"><span style="color:#BABED8">features_to_encode </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">protocol_type</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">service</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#BABED8">encoded </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> pd</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">get_dummies</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#82AAFF">features_to_encode</span><span style="color:#89DDFF">])</span></span></code></pre>
<p>For example, pd.get_dummies move from protocol_type: tcp to</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>         icmp    tcp    udp</span></span>
<span class="line"><span>0       False   True  False</span></span></code></pre>
<p>This allow the model to better capture the features.</p>
<h3 id="from-category-data-to-integer-data">From category data to integer data</h3>
<p>The attack types are described as text. We can group them into categories and assign an integer value for each category:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Multi-class classification target categories</span></span>
<span class="line"><span style="color:#BABED8">dos_attacks </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">apache2</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">back</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">land</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">neptune</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">mailbomb</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">pod</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">               '</span><span style="color:#C3E88D">processtable</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">smurf</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">teardrop</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">udpstorm</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">worm</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#BABED8">probe_attacks </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">ipsweep</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">mscan</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">nmap</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">portsweep</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">saint</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">satan</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#BABED8">privilege_attacks </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">buffer_overflow</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">loadmdoule</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">perl</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">ps</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">                     '</span><span style="color:#C3E88D">rootkit</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">sqlattack</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">xterm</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#BABED8">access_attacks </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">ftp_write</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">guess_passwd</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">http_tunnel</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">imap</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">                  '</span><span style="color:#C3E88D">multihop</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">named</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">phf</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">sendmail</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">snmpgetattack</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">                  '</span><span style="color:#C3E88D">snmpguess</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">spy</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">warezclient</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">warezmaster</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">                  '</span><span style="color:#C3E88D">xclock</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">xsnoop</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA">def</span><span style="color:#82AAFF"> map_attack</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">attack</span><span style="color:#89DDFF">):</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    if</span><span style="color:#BABED8"> attack </span><span style="color:#89DDFF">in</span><span style="color:#BABED8"> dos_attacks</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">        return</span><span style="color:#F78C6C"> 1</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    elif</span><span style="color:#BABED8"> attack </span><span style="color:#89DDFF">in</span><span style="color:#BABED8"> probe_attacks</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">        return</span><span style="color:#F78C6C"> 2</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    elif</span><span style="color:#BABED8"> attack </span><span style="color:#89DDFF">in</span><span style="color:#BABED8"> privilege_attacks</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">        return</span><span style="color:#F78C6C"> 3</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    elif</span><span style="color:#BABED8"> attack </span><span style="color:#89DDFF">in</span><span style="color:#BABED8"> access_attacks</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">        return</span><span style="color:#F78C6C"> 4</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    else</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">        return</span><span style="color:#F78C6C"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Assign multi-class category to each row</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">attack_map</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">attack</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">map_attack</span><span style="color:#89DDFF">)</span></span></code></pre>
<p>If the attack category is within dos_attacks, the map_attack function will return 1 and so on.</p>
<p>Finally, we can merge the prepared data and the numeric values into the training dataset:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Numeric features that capture various statistical properties of the traffic</span></span>
<span class="line"><span style="color:#BABED8">numeric_features </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">duration</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">src_bytes</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_bytes</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">wrong_fragment</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">urgent</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">hot</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">num_failed_logins</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_compromised</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">root_shell</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">su_attempted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">num_root</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_file_creations</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_shells</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">num_access_files</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">num_outbound_cmds</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">srv_serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">same_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">diff_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">srv_diff_host_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_srv_count</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_same_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_diff_srv_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_same_src_port_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_srv_diff_host_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_srv_serror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">dst_host_rerror_rate</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    '</span><span style="color:#C3E88D">dst_host_srv_rerror_rate</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Combine encoded categorical variables and numeric features</span></span>
<span class="line"><span style="color:#BABED8">train_set </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> encoded</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">join</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#82AAFF">numeric_features</span><span style="color:#89DDFF">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Multi-class target variable</span></span>
<span class="line"><span style="color:#BABED8">multi_y </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">attack_map</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span></code></pre>
<h2 id="training-the-model">Training the model</h2>
<p>The training data needs to be split to train the model. In this particular example, we split it into training data and test data with the 80-20 proportion. Later, the training data is split between training data and validation data following a 70-30 proportion. The later can be used to model tuning and hyper parameter optimization:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Split data into training and test sets for multi-class classification</span></span>
<span class="line"><span style="color:#BABED8">train_X</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> test_X</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> train_y</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> test_y </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> train_test_split</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">train_set</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_y</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> test_size</span><span style="color:#89DDFF">=</span><span style="color:#F78C6C">0.2</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> random_state</span><span style="color:#89DDFF">=</span><span style="color:#F78C6C">1337</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Further split the training set into separate training and validation sets</span></span>
<span class="line"><span style="color:#BABED8">multi_train_X</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> multi_val_X</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> multi_train_y</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> multi_val_y </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> train_test_split</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">train_X</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> train_y</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> test_size</span><span style="color:#89DDFF">=</span><span style="color:#F78C6C">0.3</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> random_state</span><span style="color:#89DDFF">=</span><span style="color:#F78C6C">1337</span><span style="color:#89DDFF">)</span></span></code></pre>
<p>The random state is used to introduce repeatability. Right now we have the following variables available:</p>
<ul>
<li>train_X, train_Y: core training set. Later is further split</li>
<li>test_X, test_Y: reserved for final performance testing</li>
<li>multi_train_X, multi_train_Y: training set for fitting the model</li>
<li>multi_val_X, multi_val_Y: validation set for hyper parameter optimization</li>
</ul>
<p>The next step is to use this variables to train the model</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Train RandomForest model for multi-class classification</span></span>
<span class="line"><span style="color:#BABED8">rf_model_multi </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> RandomForestClassifier</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">random_state</span><span style="color:#89DDFF">=</span><span style="color:#F78C6C">1337</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">rf_model_multi</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">fit</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_train_X</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_train_y</span><span style="color:#89DDFF">)</span></span></code></pre>
<p>Then a validation is performed over the model using multi_val_X and multi_val_Y:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Predict and evaluate the model on the validation set</span></span>
<span class="line"><span style="color:#BABED8">multi_predictions </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> rf_model_multi</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">predict</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_X</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">accuracy </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> accuracy_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_predictions</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">precision </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> precision_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> average</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">weighted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">recall </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> recall_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> average</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">weighted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">f1 </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> f1_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> average</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">weighted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Validation Set Evaluation:"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Accuracy: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">accuracy</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Precision: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">precision</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Recall: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">recall</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"F1-Score: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">f1</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Confusion Matrix for Validation Set</span></span>
<span class="line"><span style="color:#BABED8">conf_matrix </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> confusion_matrix</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_predictions</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">class_labels </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Normal</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">DoS</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">Probe</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">Privilege</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">Access</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#BABED8">sns</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">heatmap</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">conf_matrix</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> annot</span><span style="color:#89DDFF">=True,</span><span style="color:#BABED8;font-style:italic"> fmt</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">d</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> cmap</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Blues</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">            xticklabels</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">class_labels</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">            yticklabels</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">class_labels</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">title</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Network Anomaly Detection - Validation Set</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">xlabel</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Predicted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ylabel</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Actual</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">show</span><span style="color:#89DDFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Classification Report for Validation Set</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Classification Report for Validation Set:</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">classification_report</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">multi_val_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> target_names</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">class_labels</span><span style="color:#89DDFF">))</span></span></code></pre>
<p>To measure the performance, several metrics are used:</p>
<ul>
<li>Accuracy: The proportion of correctly classified instances.</li>
<li>Precision: The ratio of true positive predictions to the total predicted positives.</li>
<li>Recall: The ratio of true positive predictions to the total actual positives.</li>
<li>F1-Score: The harmonic mean of precision and recall.</li>
</ul>
<p>Later, the confusion matrix is displayed. The confusion matrix is a heat map that enable us to observe the amount of correct and incorrect predictions and which classes are wrongly assigned:</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="557" height="453" src="/_astro/confusionmatrix.CwSVqAYx_ZFAXBw.webp" ></p>
<p>Next, we will evaluate the final performance of the trained random forest model on the test set. The goal is to assess the model’s ability to generalize to completely unseen data and provide a final evaluation of its performance:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Final evaluation on the test set</span></span>
<span class="line"><span style="color:#BABED8">test_multi_predictions </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> rf_model_multi</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">predict</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_X</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">test_accuracy </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> accuracy_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> test_multi_predictions</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">test_precision </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> precision_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> test_multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> average</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">weighted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">test_recall </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> recall_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> test_multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> average</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">weighted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">test_f1 </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> f1_score</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> test_multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> average</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">weighted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">Test Set Evaluation:</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Accuracy: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">test_accuracy</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Precision: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">test_precision</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Recall: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">test_recall</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"F1-Score: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">test_f1</span><span style="color:#C792EA">:.4f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Confusion Matrix for Test Set</span></span>
<span class="line"><span style="color:#BABED8">test_conf_matrix </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> confusion_matrix</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> test_multi_predictions</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">sns</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">heatmap</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_conf_matrix</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> annot</span><span style="color:#89DDFF">=True,</span><span style="color:#BABED8;font-style:italic"> fmt</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">d</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> cmap</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Blues</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">            xticklabels</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">class_labels</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">            yticklabels</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">class_labels</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">title</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Network Anomaly Detection</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">xlabel</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Predicted</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ylabel</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Actual</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">plt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">show</span><span style="color:#89DDFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Classification Report for Test Set</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Classification Report for Test Set:</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">classification_report</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">test_y</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> test_multi_predictions</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> target_names</span><span style="color:#89DDFF">=</span><span style="color:#82AAFF">class_labels</span><span style="color:#89DDFF">))</span></span></code></pre>
<p>Once we’re satisfied with the results, the model can be saved for future usage:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> joblib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Save the trained model to a file</span></span>
<span class="line"><span style="color:#BABED8">model_filename </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">network_anomaly_detection_model.joblib</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#BABED8">joblib</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">dump</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">rf_model_multi</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> model_filename</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Model saved to </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">model_filename</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span></code></pre> </div> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2"> 2025 Adrian Galera
</footer> </main>    </body> </html> <script type="module">const t=()=>{function r(o,a){o.forEach(s=>{const e=document.querySelector(`aside a[href="#${s.target.id}"]`);s.isIntersecting?(e?.classList.remove("bg-slate-200","dark:bg-slate-800"),e?.classList.add("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200")):(e?.classList.add("bg-slate-200","dark:bg-slate-800"),e?.classList.remove("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200"))})}const i=document.querySelectorAll("div.prose h1, div.prose h2, div.prose h3, div.prose h4, div.prose h5, div.prose h6"),n={root:null,rootMargin:" 15% 0px 0% 0px ",threshold:1},d=new IntersectionObserver(r,n);i.forEach(o=>{d.observe(o)})};t();document.addEventListener("astro:after-swap",t);</script>