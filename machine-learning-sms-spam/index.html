<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.B3vRBseb.js"></script> <!-- Global Metadata --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <meta name="generator" content="Astro v5.14.1"> <!-- Canonical URL --> <link rel="canonical" href="https://www.agalera.eu/machine-learning-sms-spam/"> <!-- SEO --> <meta name="title" content="Using maching learning to fight SMS spam • agalera.eu"> <meta name="description" content="Ever wondered how AI can filter out those annoying spam SMS? In this post, I explore how machine learning models are trained to detect spam SMS using real-world techniques"> <meta name="author" content="Adrian Galera"> <!-- Open Graph / Facebook --> <meta property="og:type" content="article"> <meta property="og:url" content="https://www.agalera.eu/machine-learning-sms-spam/"> <meta property="og:title" content="Using maching learning to fight SMS spam"> <meta property="og:description" content="Ever wondered how AI can filter out those annoying spam SMS? In this post, I explore how machine learning models are trained to detect spam SMS using real-world techniques"> <meta property="og:image" content="https://www.agalera.eu/_astro/ChatGPT%20Image%20Oct%207_%202025_%2001_11_28%20AM.B0ZKJKo-.png">  <meta property="article:author" content="Adrian Galera"> <meta property="article:published_time" content="2025-10-06T00:00:00.000Z">  <!-- Twitter --> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://www.agalera.eu/machine-learning-sms-spam/"> <meta property="twitter:title" content="Using maching learning to fight SMS spam"> <meta property="twitter:description" content="Ever wondered how AI can filter out those annoying spam SMS? In this post, I explore how machine learning models are trained to detect spam SMS using real-world techniques"> <meta property="twitter:image" content="https://www.agalera.eu/_astro/ChatGPT%20Image%20Oct%207_%202025_%2001_11_28%20AM.B0ZKJKo-.png"> <!-- RSS auto-discovery --> <link rel="alternate" type="application/rss+xml" title="agalera.eu" href="/rss.xml"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script> <script type="module">const n=window.location.hostname;n.includes("agalera.eu")||(console.log("Disabling analytics..."),window["ga-disable-G-S8VGYBN25C"]=!0);window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-S8VGYBN25C");</script> <!-- Primary Meta Tags --> <title>Using maching learning to fight SMS spam • agalera.eu</title><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'dark' : 'light')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_slug_.CMnNCk3f.css"></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-8 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-4 md:p-0"> <a href="https://github.com/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://www.linkedin.com/in/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.xPnMudr4.js"></script>  </div> <script type="module">class r extends HTMLElement{constructor(){super();const e=this.querySelector("button");e&&e.addEventListener("click",t=>{if(t.currentTarget instanceof HTMLButtonElement){let n=t.currentTarget.getAttribute("aria-pressed")==="true",s=new CustomEvent("theme-change",{detail:{theme:n?"light":"dark"}});document.dispatchEvent(s),e.setAttribute("aria-pressed",String(!n))}})}}"customElements"in window&&customElements.define("theme-toggle",r);</script> <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header> <script type="module">document.addEventListener("click",e=>{const t=document.getElementById("astro-header-drawer"),n=document.getElementById("astro-header-drawer-button");t?.contains(e.target)||n?.contains(e.target)?t?.classList.toggle("translate-x-96"):t?.classList.add("translate-x-96")});</script>  <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2025-10-06T00:00:00.000Z"> Oct 6, 2025 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 10 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Using maching learning to fight SMS spam </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/sms" aria-label="sms"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> sms </span> </a><a href="/tags/python" aria-label="python"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> python </span> </a><a href="/tags/ml" aria-label="ml"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> ml </span> </a> </div> </header> <img src="/_astro/ChatGPT%20Image%20Oct%207_%202025_%2001_11_28%20AM.B0ZKJKo-_Z1uVz6a.jpg" loading="eager" alt="img of Using maching learning to fight SMS spam" decoding="async" fetchpriority="auto" width="1000" height="500" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://www.agalera.eu/machine-learning-sms-spam/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.agalera.eu/machine-learning-sms-spam/" aria-label="Share on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <h2 class="font-bold mb-3 text-2xl dark:text-white">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#getting-the-dataset" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Getting the dataset </a>  </li><li class="flex flex-col"> <a href="#exploratory-dataset-analysis" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Exploratory Dataset Analysis </a>  </li><li class="flex flex-col"> <a href="#data-preparation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Data preparation </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#lowercase" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Lowercase </a>  </li><li class="flex flex-col"> <a href="#remove-punctuation-symbols" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Remove punctuation symbols </a>  </li><li class="flex flex-col"> <a href="#tokenization" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Tokenization </a>  </li><li class="flex flex-col"> <a href="#remove-stop-words" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Remove stop words </a>  </li><li class="flex flex-col"> <a href="#stemming" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Stemming </a>  </li><li class="flex flex-col"> <a href="#back-to-string" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Back to string </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#feature-extraction" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Feature extraction </a>  </li><li class="flex flex-col"> <a href="#training-the-model" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Training the model </a>  </li><li class="flex flex-col"> <a href="#predicting-real-world-messages" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Predicting real world messages </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>While reviewing the contents of <a href="https://academy.hackthebox.com/" title="HackTheBox academy">Hack the box Academy</a> I stumbled upon a course about using AI in infosec tasks. I’ll write a series of articles about what I learnt there.</p>
<p>This is the first one and it is about using machine learning (a subfield of AI) to write a filter that classifies SMS as normal or as spam depending on the content. This article highlights the the different stages on a machine learning pipeline.</p>
<p>There are some specific details about natural language processing in the feature extraction and dataset preparation; every application of machine learning will have its own intricacies.</p>
<h2 id="getting-the-dataset">Getting the dataset</h2>
<p>I’ll use a <a href="https://archive.ics.uci.edu/static/public/228/sms+spam+collection.zip" title="dataset">dataset</a> coming from the combined efforts of Tiago A. Almeida and Akebo Yamakami at the School of Electrical and Computer Engineering at the University of Campinas in Brazil, and José María Gómez Hidalgo at the R&#x26;D Department of Optenet in Spain. The following code will download the dataset, unzipped and check what’s in the extracted folder:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> zipfile</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> io</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># URL of the dataset</span></span>
<span class="line"><span style="color:#BABED8">url </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">https://archive.ics.uci.edu/static/public/228/sms+spam+collection.zip</span><span style="color:#89DDFF">"</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Download the dataset</span></span>
<span class="line"><span style="color:#BABED8">response </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> requests</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">get</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">url</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">if</span><span style="color:#BABED8"> response</span><span style="color:#89DDFF">.</span><span style="color:#F07178">status_code</span><span style="color:#89DDFF"> ==</span><span style="color:#F78C6C"> 200</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Download successful</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">else</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Failed to download the dataset</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Extract the dataset</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">with</span><span style="color:#BABED8"> zipfile</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ZipFile</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">io</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">BytesIO</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">response</span><span style="color:#89DDFF">.</span><span style="color:#F07178">content</span><span style="color:#89DDFF">))</span><span style="color:#89DDFF;font-style:italic"> as</span><span style="color:#BABED8"> z</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#BABED8">    z</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">extractall</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">sms_spam_collection</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Extraction successful</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># List the extracted files</span></span>
<span class="line"><span style="color:#BABED8">extracted_files </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> os</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">listdir</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">sms_spam_collection</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Extracted files:</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> extracted_files</span><span style="color:#89DDFF">)</span></span></code></pre>
<h2 id="exploratory-dataset-analysis">Exploratory Dataset Analysis</h2>
<p>Once we have the dataset, usually it is a good idea to explore it to see how the data looks like, and observe some statistical properties such as average, max, min values. It is also important to spot some missing and duplicated data (and remove it if required)</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> pandas </span><span style="color:#89DDFF;font-style:italic">as</span><span style="color:#BABED8"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Load the dataset</span></span>
<span class="line"><span style="color:#BABED8">df </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> pd</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">read_csv</span><span style="color:#89DDFF">(</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">sms_spam_collection/SMSSpamCollection</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    sep</span><span style="color:#89DDFF">=</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\t</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    header</span><span style="color:#89DDFF">=None,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    names</span><span style="color:#89DDFF">=[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">label</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">],</span></span>
<span class="line"><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Display basic information about the dataset</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">-------------------- HEAD --------------------</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">())</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">-------------------- DESCRIBE --------------------</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">describe</span><span style="color:#89DDFF">())</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">-------------------- INFO --------------------</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">info</span><span style="color:#89DDFF">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Check for missing values</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Missing values:</span><span style="color:#BABED8">\n</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">isnull</span><span style="color:#89DDFF">().</span><span style="color:#82AAFF">sum</span><span style="color:#89DDFF">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Check for duplicates</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Duplicate entries:</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">duplicated</span><span style="color:#89DDFF">().</span><span style="color:#82AAFF">sum</span><span style="color:#89DDFF">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Remove duplicates if any</span></span>
<span class="line"><span style="color:#BABED8">df </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">drop_duplicates</span><span style="color:#89DDFF">()</span></span></code></pre>
<p>Now the data is clean, but its format does not allow further processing by any ML algorithm. At this point, we need to prepare the data to extract features that we can pass to the machine learning model.</p>
<h2 id="data-preparation">Data preparation</h2>
<p>Here the data will be modified according to some specific transformations related with natural language processing.</p>
<h3 id="lowercase">Lowercase</h3>
<p>The relevance of casing is irrelevant to the problem. We can reduce the dimension of casing by having the text only in lowercase:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Preprocessing the text</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> nltk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Download the necessary NLTK data files</span></span>
<span class="line"><span style="color:#BABED8">nltk</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">download</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">punkt</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">nltk</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">download</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">punkt_tab</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">nltk</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">download</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">stopwords</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">=== BEFORE ANY PREPROCESSING ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Convert all message text to lowercase</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#F07178">str</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">lower</span><span style="color:#89DDFF">()</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">=== AFTER LOWERCASING ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span></code></pre>
<h3 id="remove-punctuation-symbols">Remove punctuation symbols</h3>
<p>Similar to casing, the fact that a message contains commas or point, etc, it is irrelevant to detect if the SMS is spam or not.</p>
<p>However, there are some special symbols that we want to keep. Usually spam campaigns are used to lure people into cons or something that has to do with money, so we really want to have the dollar symbol <code>$</code> in our dataset. The following code with regex remove any non letter character or <code>$</code> or <code>!</code>:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Remove non-essential punctuation and numbers, keep useful symbols like $ and !</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> x</span><span style="color:#89DDFF">:</span><span style="color:#82AAFF"> re</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">sub</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">r</span><span style="color:#89DDFF">"[^</span><span style="color:#C3E88D">a-z\s$!</span><span style="color:#89DDFF">]"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> ""</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> x</span><span style="color:#89DDFF">))</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">=== AFTER REMOVING PUNCTUATION &#x26; NUMBERS (except $ and !) ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span></code></pre>
<h3 id="tokenization">Tokenization</h3>
<p>In order to continue preparing the dataset, we need to treat each message as an array instead of string. We split each message by using words to create the array. This process is called tokenization.</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> nltk</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">tokenize </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> word_tokenize</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Split each message into individual tokens</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">word_tokenize</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">=== AFTER TOKENIZATION ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span></code></pre>
<p>The data will change from:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0    go until jurong point crazy available only in ...</span></span></code></pre>
<p>to:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0   [go, until, jurong, point, crazy, available, o...]</span></span></code></pre>
<h3 id="remove-stop-words">Remove stop words</h3>
<p>There are some common connectors will not contribute to the model. These are stop words such as the, and, etc… The following code uses nltk library to remove them from the text and only keep relevant words:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> nltk</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">corpus </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> stopwords</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Define a set of English stop words and remove them from the tokens</span></span>
<span class="line"><span style="color:#BABED8">stop_words </span><span style="color:#89DDFF">=</span><span style="color:#FFCB6B"> set</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">stopwords</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">words</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">english</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">))</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> x</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> [</span><span style="color:#82AAFF">word </span><span style="color:#89DDFF;font-style:italic">for</span><span style="color:#82AAFF"> word </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#82AAFF"> x </span><span style="color:#89DDFF;font-style:italic">if</span><span style="color:#82AAFF"> word </span><span style="color:#89DDFF">not</span><span style="color:#89DDFF"> in</span><span style="color:#82AAFF"> stop_words</span><span style="color:#89DDFF">])</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">=== AFTER REMOVING STOP WORDS ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span></code></pre>
<h3 id="stemming">Stemming</h3>
<p>We can join similar words that have the same meaning, but they use different tenses. For example, <code>run</code> and <code>running</code> will have a similar meaning, therefore, we can only keep <code>run</code> in the dataset. This way the dataset size can be reduced and the model will be able to work more efficiently.</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> nltk</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">stem </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> PorterStemmer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Stem each token to reduce words to their base form</span></span>
<span class="line"><span style="color:#BABED8">stemmer </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> PorterStemmer</span><span style="color:#89DDFF">()</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> x</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> [</span><span style="color:#82AAFF">stemmer</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">stem</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">word</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF;font-style:italic"> for</span><span style="color:#82AAFF"> word </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#82AAFF"> x</span><span style="color:#89DDFF">])</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">=== AFTER STEMMING ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span></code></pre>
<p>Another technique to reduce common words to the root is called <code>lemmatize</code>. This technique is similar to <code>stemming</code> but keeps better root words at the expense of being more computationally intensive because it takes into account the part of the speech the word belongs. An example of usage can be:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> nltk</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">stem </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> WordNetLemmatizer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">nltk</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">download</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">wordnet</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">lemmatizer </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> WordNetLemmatizer</span><span style="color:#89DDFF">()</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">clean_text</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">clean_text</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> x</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> [</span><span style="color:#82AAFF">lemmatizer</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">lemmatize</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">word</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF;font-style:italic"> for</span><span style="color:#82AAFF"> word </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#82AAFF"> x</span><span style="color:#89DDFF">])</span></span></code></pre>
<h3 id="back-to-string">Back to string</h3>
<p>When all the dataset preparation is done, we can revert the message to string to extract the features in the next stage:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Rejoin tokens into a single string for feature extraction</span></span>
<span class="line"><span style="color:#BABED8">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> x</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> "</span><span style="color:#89DDFF"> "</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">join</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">x</span><span style="color:#89DDFF">))</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#BABED8">\n</span><span style="color:#C3E88D">=== AFTER JOINING TOKENS BACK INTO STRINGS ===</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">head</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">5</span><span style="color:#89DDFF">))</span></span></code></pre>
<h2 id="feature-extraction">Feature extraction</h2>
<p>Machine learning algorithms do not understand anything about words or message or strings. Instead, they use algebra or statistics to detect (or learn) the underlying patterns in the data. So, we need to transform our dataset of messages into some meaningful features for the model.</p>
<p>In this case, a good feature extractor is to capture a bag of words. This is done by processing all the remaining words in the dataset and create an array of 0 and 1s. Each position represents a word in the bag, if the value of the array position is 1, it means the word is present in the message, otherwise the value is 0.</p>
<p>We can refine this behavior by considering not only 1 word ( called <code>unigram</code>), but a combination of two words, called <code>bigram</code>. By combining <code>unigrams</code> and <code>bigrams</code> in the matrix, the model will capture more complex relationships between words.</p>
<p>Furthermore, we should exclude terms with very few occurrences (will contribute to overfitting) or terms with too much occurrences (will only create noise because the information they provide is very small).</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">feature_extraction</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">text </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> CountVectorizer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Initialize CountVectorizer with bigrams, min_df, and max_df to focus on relevant terms</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># min_df = 1: A term must appear in at least one document to be included.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># max_df = 0.9: Terms that appear in more than 90 % of the documents are excluded, removing common words that provide not mucch differentiation.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># ngram_range = (1, 2): The feature matrix captures individual words and common word pairs by including unigrams and bigrams</span></span>
<span class="line"><span style="color:#BABED8">vectorizer </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> CountVectorizer</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">min_df</span><span style="color:#89DDFF"> =</span><span style="color:#F78C6C"> 1</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> max_df</span><span style="color:#89DDFF"> =</span><span style="color:#F78C6C"> 0.9</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> ngram_range</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> (</span><span style="color:#F78C6C">1</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 2</span><span style="color:#89DDFF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Fit and transform the message column</span></span>
<span class="line"><span style="color:#BABED8">X </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> vectorizer</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">fit_transform</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Labels(target variable)</span></span>
<span class="line"><span style="color:#BABED8">y </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">label</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">apply</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">lambda</span><span style="color:#BABED8;font-style:italic"> x</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 1</span><span style="color:#89DDFF;font-style:italic"> if</span><span style="color:#82AAFF"> x </span><span style="color:#89DDFF">==</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">spam</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF;font-style:italic"> else</span><span style="color:#F78C6C"> 0</span><span style="color:#89DDFF">)</span><span style="color:#676E95;font-style:italic">  # Converting labels to 1 and 0</span></span></code></pre>
<p>Similarly, the labels <code>spam</code> or <code>ham</code> will be converted to 1 or 0.</p>
<p>Another good feature extractor is <code>TF-IDF</code> which stands for <code>Term Frequency - Innverse Document Function</code>. Citing wikipedia:</p>
<blockquote>
<p>In information retrieval, tf–idf (term frequency–inverse document frequency, TF*IDF, TFIDF, TF–IDF, or Tf–idf) is a measure of importance of a word to a document in a collection or corpus, adjusted for the fact that some words appear more frequently in general.</p>
</blockquote>
<p>A usage example of TF-IDF is very similar to CountVectorizer:</p>
<p><code>vectorizer = TfidfVectorizer(min_df=2, max_df=0.85, ngram_range=(1, 2))</code></p>
<h2 id="training-the-model">Training the model</h2>
<p>The features now should be passed to the model to run the training phase and learn the patterns of the dataset. The chosen model is <code>Multinomial Naive Baytes</code>. This model accepts an hyperparameter called <code>alpha</code> which controls how the model handles unseen data and prevents the probabilities to be zero.</p>
<p>To determine the optimal value of alpha, we can train different values and get the one that outputs better performance. To measure the performance, we can rely on the <code>F1 score</code> which combines precision and recall.</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">model_selection </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> train_test_split</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> GridSearchCV</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">naive_bayes </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> MultinomialNB</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#BABED8"> sklearn</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">pipeline </span><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> Pipeline</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Build the pipeline by combining vectorization and classification</span></span>
<span class="line"><span style="color:#BABED8">pipeline </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> Pipeline</span><span style="color:#89DDFF">([</span></span>
<span class="line"><span style="color:#89DDFF">  (</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">vectorizer</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> vectorizer</span><span style="color:#89DDFF">),</span></span>
<span class="line"><span style="color:#89DDFF">  (</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">classifier</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> MultinomialNB</span><span style="color:#89DDFF">())</span></span>
<span class="line"><span style="color:#89DDFF">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Use GridSearchCV to try out different hyperparameter(alpha) on the classifier and get the one with better results.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Perform the grid search with 5-fold cross-validation and the F1-score as metric</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Define the parameter grid for hyperparameter tuning</span></span>
<span class="line"><span style="color:#BABED8">param_grid </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">classifier__alpha</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> [</span><span style="color:#F78C6C">0.01</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0.1</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0.15</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0.2</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0.25</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0.5</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0.75</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 1.0</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#89DDFF">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">grid_search </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> GridSearchCV</span><span style="color:#89DDFF">(</span></span>
<span class="line"><span style="color:#82AAFF">    pipeline</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#82AAFF">    param_grid</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    cv</span><span style="color:#89DDFF"> =</span><span style="color:#F78C6C"> 5</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    scoring</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">f1</span><span style="color:#89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Fit the grid search on the full dataset</span></span>
<span class="line"><span style="color:#BABED8">grid_search</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">fit</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">df</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">message</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">],</span><span style="color:#82AAFF"> y</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Extract the best model identified by the grid search</span></span>
<span class="line"><span style="color:#BABED8">best_model </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> grid_search</span><span style="color:#89DDFF">.</span><span style="color:#F07178">best_estimator_</span></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Best model parameters:</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> grid_search</span><span style="color:#89DDFF">.</span><span style="color:#F07178">best_params_</span><span style="color:#89DDFF">)</span></span></code></pre>
<p><code>GridSeachCV</code> stands for grid search cross validation. <code>cv = 5</code> implies that the algorithm will split the dataset into five parts, four will be used to train the model and one to test. This process is repeated so that each part of the dataset is used once for testing.</p>
<h2 id="predicting-real-world-messages">Predicting real world messages</h2>
<p>At this point, the model is trained. We need to explore how the model generalizes for real world messages. To do so, we need to transform the messages to the same features the model expect and tell the model to predict the labels:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#676E95;font-style:italic"># Example SMS messages for evaluation</span></span>
<span class="line"><span style="color:#BABED8">new_messages </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">Congratulations! You've won a $1000 Walmart gift card. Go to http://bit.ly/1234 to claim now.</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">Hey, are we still meeting up for lunch today?</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">Urgent! Your account has been compromised. Verify your details here: www.fakebank.com/verify</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">Reminder: Your appointment is scheduled for tomorrow at 10am.</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">    "</span><span style="color:#C3E88D">FREE entry in a weekly competition to win an iPad. Just text WIN to 80085 now!</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> numpy </span><span style="color:#89DDFF;font-style:italic">as</span><span style="color:#BABED8"> np</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Preprocess function that mirrors the training-time preprocessing</span></span>
<span class="line"><span style="color:#C792EA">def</span><span style="color:#82AAFF"> preprocess_message</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">message</span><span style="color:#89DDFF">):</span></span>
<span class="line"><span style="color:#BABED8">    message </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> message</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">lower</span><span style="color:#89DDFF">()</span></span>
<span class="line"><span style="color:#BABED8">    message </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> re</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">sub</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">r</span><span style="color:#89DDFF">"[^</span><span style="color:#C3E88D">a-z\s$!</span><span style="color:#89DDFF">]"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> ""</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> message</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">    tokens </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> word_tokenize</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">message</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">    tokens </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#BABED8">word </span><span style="color:#89DDFF;font-style:italic">for</span><span style="color:#BABED8"> word </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#BABED8"> tokens </span><span style="color:#89DDFF;font-style:italic">if</span><span style="color:#BABED8"> word </span><span style="color:#89DDFF">not</span><span style="color:#89DDFF"> in</span><span style="color:#BABED8"> stop_words</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#BABED8">    tokens </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#BABED8">stemmer</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">stem</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">word</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF;font-style:italic"> for</span><span style="color:#BABED8"> word </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#BABED8"> tokens</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    return</span><span style="color:#89DDFF"> "</span><span style="color:#89DDFF"> "</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">join</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">tokens</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Preprocess and vectorize messages</span></span>
<span class="line"><span style="color:#BABED8">processed_messages </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> [</span><span style="color:#82AAFF">preprocess_message</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">msg</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF;font-style:italic"> for</span><span style="color:#BABED8"> msg </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#BABED8"> new_messages</span><span style="color:#89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Transform preprocessed messages into feature vectors</span></span>
<span class="line"><span style="color:#BABED8">X_new </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> best_model</span><span style="color:#89DDFF">.</span><span style="color:#F07178">named_steps</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">vectorizer</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">transform</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">processed_messages</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Predict with the trained classifier</span></span>
<span class="line"><span style="color:#BABED8">predictions </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> best_model</span><span style="color:#89DDFF">.</span><span style="color:#F07178">named_steps</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">classifier</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">predict</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">X_new</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">prediction_probabilities </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> best_model</span><span style="color:#89DDFF">.</span><span style="color:#F07178">named_steps</span><span style="color:#89DDFF">[</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">classifier</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">].</span><span style="color:#82AAFF">predict_proba</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">X_new</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Display predictions and probabilities for each evaluated message</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">for</span><span style="color:#BABED8"> i</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> msg </span><span style="color:#89DDFF;font-style:italic">in</span><span style="color:#82AAFF"> enumerate</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">new_messages</span><span style="color:#89DDFF">):</span></span>
<span class="line"><span style="color:#BABED8">    prediction </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">Spam</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF;font-style:italic"> if</span><span style="color:#BABED8"> predictions</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">i</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> ==</span><span style="color:#F78C6C"> 1</span><span style="color:#89DDFF;font-style:italic"> else</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">Not-Spam</span><span style="color:#89DDFF">"</span></span>
<span class="line"><span style="color:#BABED8">    spam_probability </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> prediction_probabilities</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">i</span><span style="color:#89DDFF">][</span><span style="color:#F78C6C">1</span><span style="color:#89DDFF">]</span><span style="color:#676E95;font-style:italic">  # Probability of being spam</span></span>
<span class="line"><span style="color:#BABED8">    ham_probability </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> prediction_probabilities</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">i</span><span style="color:#89DDFF">][</span><span style="color:#F78C6C">0</span><span style="color:#89DDFF">]</span><span style="color:#676E95;font-style:italic">   # Probability of being not spam</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Message: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">msg</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Prediction: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">prediction</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Spam Probability: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">spam_probability</span><span style="color:#C792EA">:.2f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Not-Spam Probability: </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">ham_probability</span><span style="color:#C792EA">:.2f</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#82AAFF">    print</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">-</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF"> *</span><span style="color:#F78C6C"> 50</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span></code></pre>
<p>Once the results are satisfactory, the model can be persisted using <code>joblib</code>:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> joblib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Save the trained model to a file for future use</span></span>
<span class="line"><span style="color:#BABED8">model_filename </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">spam_detection_model.joblib</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#BABED8">joblib</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">dump</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">best_model</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> model_filename</span><span style="color:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">print</span><span style="color:#89DDFF">(</span><span style="color:#C792EA">f</span><span style="color:#C3E88D">"Model saved to </span><span style="color:#F78C6C">{</span><span style="color:#82AAFF">model_filename</span><span style="color:#F78C6C">}</span><span style="color:#C3E88D">"</span><span style="color:#89DDFF">)</span></span></code></pre> </div> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2"> 2025 Adrian Galera
</footer> </main>    </body> </html> <script type="module">const t=()=>{function r(o,a){o.forEach(s=>{const e=document.querySelector(`aside a[href="#${s.target.id}"]`);s.isIntersecting?(e?.classList.remove("bg-slate-200","dark:bg-slate-800"),e?.classList.add("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200")):(e?.classList.add("bg-slate-200","dark:bg-slate-800"),e?.classList.remove("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200"))})}const i=document.querySelectorAll("div.prose h1, div.prose h2, div.prose h3, div.prose h4, div.prose h5, div.prose h6"),n={root:null,rootMargin:" 15% 0px 0% 0px ",threshold:1},d=new IntersectionObserver(r,n);i.forEach(o=>{d.observe(o)})};t();document.addEventListener("astro:after-swap",t);</script>