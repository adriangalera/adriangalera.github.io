<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"> <!-- Global Metadata --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <meta name="generator" content="Astro v4.0.8"> <!-- Canonical URL --> <link rel="canonical" href="https://www.agalera.eu/raspberry-pi-qa/"> <!-- SEO --> <meta name="title" content="Raspberry Pi for QA • agalera.eu"> <meta name="description" content="The design and implementation of multiple QA services (Network tweaking, VPN, Packet analysis,..) on a NodeJS server on a Raspberry Pi"> <meta name="author" content="Adrian Galera"> <!-- Open Graph / Facebook --> <meta property="og:type" content="article"> <meta property="og:url" content="https://www.agalera.eu/raspberry-pi-qa/"> <meta property="og:title" content="Raspberry Pi for QA"> <meta property="og:description" content="The design and implementation of multiple QA services (Network tweaking, VPN, Packet analysis,..) on a NodeJS server on a Raspberry Pi"> <meta property="og:image" content="https://www.agalera.eu/_astro/featured-image.3_0P9Nuh.jpg">  <meta property="article:author" content="Adrian Galera"> <meta property="article:published_time" content="2018-09-21T00:00:00.000Z">  <!-- Twitter --> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://www.agalera.eu/raspberry-pi-qa/"> <meta property="twitter:title" content="Raspberry Pi for QA"> <meta property="twitter:description" content="The design and implementation of multiple QA services (Network tweaking, VPN, Packet analysis,..) on a NodeJS server on a Raspberry Pi"> <meta property="twitter:image" content="https://www.agalera.eu/_astro/featured-image.3_0P9Nuh.jpg"> <!-- RSS auto-discovery --> <link rel="alternate" type="application/rss+xml" title="agalera.eu" href="/rss.xml"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>  <!-- Primary Meta Tags --> <title>Raspberry Pi for QA • agalera.eu</title><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'dark' : 'light')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_slug_.3AapyeBs.css" /><script type="module" src="/_astro/hoisted.JAyXFufJ.js"></script></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-8 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-4 md:p-0"> <a href="https://github.com/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://www.linkedin.com/in/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg> </span>  </a><a href="https://www.agalera.eu/cv" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="CV">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-file-cv" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14 3v4a1 1 0 0 0 1 1h4"></path> <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"></path> <path d="M11 12.5a1.5 1.5 0 0 0 -3 0v3a1.5 1.5 0 0 0 3 0"></path> <path d="M13 11l1.5 6l1.5 -6"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header>   <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2018-09-21T00:00:00.000Z"> Sep 21, 2018 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 5 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Raspberry Pi for QA </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/linux" aria-label="linux"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> linux </span> </a><a href="/tags/nodejs" aria-label="nodejs"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> nodejs </span> </a><a href="/tags/raspberry-pi" aria-label="raspberry-pi"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> raspberry-pi </span> </a><a href="/tags/qa" aria-label="qa"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> qa </span> </a><a href="/tags/testing" aria-label="testing"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> testing </span> </a> </div> </header> <img src="/_astro/featured-image.3_0P9Nuh_Z1Yceq5.jpg" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Raspberry Pi for QA" width="1000" height="500" decoding="async"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://www.agalera.eu/raspberry-pi-qa/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://www.agalera.eu/raspberry-pi-qa/" aria-label="Share on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <h2 class="font-bold mb-3 text-2xl dark:text-white">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#the-problems" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> The problems </a>  </li><li class="flex flex-col"> <a href="#the-solutions" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> The solutions … </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#playing-with-tc-and-ifb" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Playing with tc and ifb </a>  </li><li class="flex flex-col"> <a href="#openvpn-and-iptables" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> OpenVPN and Iptables </a>  </li><li class="flex flex-col"> <a href="#networking-stuff" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Networking stuff … </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#the-code" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> The code </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>On a previous company the QA team needed to perform some scenarios that were difficult to reproduce, for instance force a buffering event. Their setup require deep technical understanding of Linux. In order to ease its world, I decided to create a neat service running on a Raspberry Pi.</p>
<h2 id="the-problems">The problems</h2>
<p>Concretely, the scenarios that the QA needed to cover were:</p>
<p><strong>Restrict the network performance</strong></p>
<p>The test that the QA team were performing, included provoking buffering issues in media players. They found issues on how this could be achieved: in Chrome it could be achieved through Developer Tools, but what about mobile devices, or even worst: some weird embedded media players?</p>
<p><strong>Access Geo-blocked content</strong>
Since the company had customers world-wide and some of them used Geo-blocked content, they need to access those contents through the use of VPNs. This required spending some time configuration the VPN clients on their side</p>
<p><strong>IP Blocking</strong>
There were some scenarios (I cannot remember right now) that required to block the connection to some IP. This is really easy to do on a UNIX machine with iptables, but good luck doing that on Windows.</p>
<p><strong>Modify DNS records</strong>
It were some scenario where they needed to change the DNS records. For instance: <a href="http://www.google.com">www.google.com</a> -> 192.168.1.100. I don’t remember the rationale to this requirement :(</p>
<p><strong>Analyse HTTPS Traffic</strong>
In the majority of the environments the connections with the company server’s were made with HTTPS. This caused a little bit of headache while analysing the HTTP traffic.</p>
<h2 id="the-solutions">The solutions …</h2>
<p>Since most of the scenarios require some networking tweaks, the obvious decision was Linux, even better: Raspberry Pi. The project consist in a NodeJS Express application that executed scripts on the RaspberryPi.</p>
<p>The raspberry PI have two network interfaces: the LAN and the WiFi. The configuration is setup in the interfaces file:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#FFCB6B">auto</span><span style="color:#C3E88D"> lo</span></span>
<span class="line"><span style="color:#FFCB6B">iface</span><span style="color:#C3E88D"> lo</span><span style="color:#C3E88D"> inet</span><span style="color:#C3E88D"> loopback</span></span>
<span class="line"><span style="color:#FFCB6B">auto</span><span style="color:#C3E88D"> eth0</span></span>
<span class="line"><span style="color:#FFCB6B">auto</span><span style="color:#C3E88D"> wlan0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">#static ethernet conf</span></span>
<span class="line"><span style="color:#FFCB6B">iface</span><span style="color:#C3E88D"> eth0</span><span style="color:#C3E88D"> inet</span><span style="color:#C3E88D"> static</span></span>
<span class="line"><span style="color:#FFCB6B">address</span><span style="color:#F78C6C"> 192.168</span><span style="color:#C3E88D">.1.100</span></span>
<span class="line"><span style="color:#FFCB6B">netmask</span><span style="color:#F78C6C"> 255.255</span><span style="color:#C3E88D">.255.0</span></span>
<span class="line"><span style="color:#FFCB6B">gateway</span><span style="color:#F78C6C">	192.168</span><span style="color:#C3E88D">.1.1</span></span>
<span class="line"><span style="color:#FFCB6B">dns-nameservers</span><span style="color:#F78C6C"> 8.8</span><span style="color:#C3E88D">.4.4</span></span>
<span class="line"><span style="color:#FFCB6B">iface</span><span style="color:#C3E88D"> wlan0</span><span style="color:#C3E88D"> inet</span><span style="color:#C3E88D"> static</span></span>
<span class="line"><span style="color:#FFCB6B">address</span><span style="color:#F78C6C"> 192.168</span><span style="color:#C3E88D">.150.1</span></span>
<span class="line"><span style="color:#FFCB6B">netmask</span><span style="color:#F78C6C"> 255.255</span><span style="color:#C3E88D">.255.0</span></span></code></pre>
<p>In the WiFi interface hostapd service is configured in order to serve a WiFi connection. This will configure the traffic outgoing traffic from wlan0 to eth0.</p>
<h3 id="playing-with-tc-and-ifb">Playing with tc and ifb</h3>
<p>The network performance restrictions can be applied using the tc command and the ifb module on Linux. This module redirects the traffic from one real network interface to a virtual one. When the traffic passes through the ifb0 interface the token bucket (<a href="https://en.wikipedia.org/wiki/Token_bucket#Hierarchical_token_bucket">htb</a>) applies the network configuration</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic">#Enable ifb module and setup the ifb0 interface</span></span>
<span class="line"><span style="color:#FFCB6B">modprobe</span><span style="color:#C3E88D"> ifb</span><span style="color:#C3E88D"> numifbs=</span><span style="color:#F78C6C">1</span><span style="color:#89DDFF"> &#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;&#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;</span><span style="color:#FFCB6B"> ip</span><span style="color:#C3E88D"> link</span><span style="color:#C3E88D"> set</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> ifb0</span><span style="color:#C3E88D"> up</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">#Create a device that redirects all the traffic</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">#from eth0 to ifb0</span></span>
<span class="line"><span style="color:#FFCB6B">tc</span><span style="color:#C3E88D"> qdisc</span><span style="color:#C3E88D"> add</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> eth0</span><span style="color:#C3E88D"> handle</span><span style="color:#C3E88D"> ffff:</span><span style="color:#C3E88D"> ingress</span><span style="color:#89DDFF"> &#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;&#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#FFCB6B">tc</span><span style="color:#C3E88D"> filter</span><span style="color:#C3E88D"> add</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> eth0</span><span style="color:#C3E88D"> parent</span><span style="color:#C3E88D"> ffff:</span><span style="color:#C3E88D"> protocol</span><span style="color:#C3E88D"> ip</span><span style="color:#C3E88D"> u32</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#BABED8">match </span><span style="color:#C3E88D">u32</span><span style="color:#F78C6C"> 0</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D"> action</span><span style="color:#C3E88D"> mirred</span><span style="color:#C3E88D"> egress</span><span style="color:#C3E88D"> redirect</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> ifb0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">#Modify the token bucket configuration</span></span>
<span class="line"><span style="color:#FFCB6B">tc</span><span style="color:#C3E88D"> qdisc</span><span style="color:#C3E88D"> add</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> ifb0</span><span style="color:#C3E88D"> root</span><span style="color:#C3E88D"> handle</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">:</span><span style="color:#C3E88D"> htb</span><span style="color:#C3E88D"> default</span><span style="color:#F78C6C"> 10</span><span style="color:#89DDFF"> &#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;&#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#FFCB6B">tc</span><span style="color:#C3E88D"> class</span><span style="color:#C3E88D"> add</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> ifb0</span><span style="color:#C3E88D"> parent</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">:</span><span style="color:#C3E88D"> classid</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">:1</span><span style="color:#C3E88D"> htb</span><span style="color:#C3E88D"> rate</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">mb</span><span style="color:#89DDFF"> &#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;&#x26;</span><span style="color:#FFCB6B">amp</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#FFCB6B">tc</span><span style="color:#C3E88D"> class</span><span style="color:#C3E88D"> add</span><span style="color:#C3E88D"> dev</span><span style="color:#C3E88D"> ifb0</span><span style="color:#C3E88D"> parent</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">:1</span><span style="color:#C3E88D"> classid</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">:10</span><span style="color:#C3E88D"> htb</span><span style="color:#C3E88D"> rate</span><span style="color:#F78C6C"> 1</span><span style="color:#C3E88D">mb</span></span></code></pre>
<h3 id="openvpn-and-iptables">OpenVPN and Iptables</h3>
<p>In order to be able to avoid the Geo-blocking of contents, the company provide us a commercial VPN. This consisted on a series of OpenVPN configuration scripts for multiple countries. Therefore, the app only needs to call openvpn:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#FFCB6B">openvpn</span><span style="color:#C3E88D"> ALBANIA-TCP.ovpn</span></span></code></pre>
<p>It’s really easy to block an IP on a Linux box, the app only needs to call the iptables, for example:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#FFCB6B">iptables</span><span style="color:#C3E88D"> -I</span><span style="color:#C3E88D"> FORWARD</span><span style="color:#C3E88D"> -s</span><span style="color:#F78C6C"> 192.168</span><span style="color:#C3E88D">.150.0/24</span><span style="color:#C3E88D"> -d</span><span style="color:#F78C6C"> 8.8</span><span style="color:#C3E88D">.8.8</span><span style="color:#C3E88D">  -j</span><span style="color:#C3E88D"> DROP</span></span></code></pre>
<p>This snippet blocks the outgoing connections to 8.8.8.8 that goes out from the WiFi network</p>
<h3 id="networking-stuff">Networking stuff …</h3>
<p>Regarding DNS Spoofing, it’s a little bit trickier, however the <strong>dnsmasq</strong> service is very useful in that situation.</p>
<p><img alt="dnsmasq schema" title="dnsmasq schema"  src="/_astro/dnsmasq.InLO0Yof_1DScFy.webp" width="578" height="301" loading="lazy" decoding="async">
<em>dnsmasq schema</em></p>
<p>The clients connected to the WiFi will resolve the DNS queries thanks to the dnsmasq client listening to incoming connections. This service is able to perform custom DNS resolutions based on a file that works like a /etc/hosts file.</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span>192.168.56.1   ubuntu.tecmint.lan</span></span>
<span class="line"><span>192.168.56.10  centos.tecmint.lan</span></span></code></pre>
<p>Regarding the HTTPS Sniffer, the implemented solution implies having the SSL certificates from the company installed in a reverse proxy that terminates the SSL connection and forwards the HTTP traffic to an internal server that stores the decrypted requests on a cache.</p>
<p><img alt="https proxy setup" title="https proxy setup"  src="/_astro/httpsproxy.Nf_J_nQ1_Z1kSekw.webp" width="551" height="201" loading="lazy" decoding="async">
HTTPS sniffer setup</p>
<p>This cache can be queried from the GUI to inspect the requests. There’s an additional implementation that allows to run pcap capture software directly on the network interface to inspect the packets from the UI.</p>
<p>This environment requires a little setup, that is the configuration of the proxy on the computers of the QA team.</p>
<p>Finally, the QA team were able to save a lot of time setting up their scenarios. With this app it’s only a matter of clicking buttons instead of executing weird scripts</p>
<h2 id="the-code">The code</h2>
<p>Don’t blame too much on the code quality: the whole project was implemented few years ago and as a side project on one or two weekends <a href="https://github.com/adriangalera/rpitester"></a><a href="https://github.com/adriangalera/rpitester">https://github.com/adriangalera/rpitester</a>
Here’s a video of me presenting that project ;)</p>
<iframe src="https://www.youtube.com/embed/aUaEF87pdms?rel=0&#x26;showinfo=0" width="560" height="315" frameborder="0" allowfullscreen></iframe> </div> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2"> 2025 Adrian Galera
</footer> </main>    </body> </html> 