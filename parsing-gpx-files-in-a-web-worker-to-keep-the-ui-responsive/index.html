<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BZs-2RF_.js"></script> <!-- Global Metadata --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <meta name="generator" content="Astro v5.6.2"> <!-- Canonical URL --> <link rel="canonical" href="https://www.agalera.eu/parsing-gpx-files-in-a-web-worker-to-keep-the-ui-responsive/"> <!-- SEO --> <meta name="title" content="Keep the UI responsive by using web worker • agalera.eu"> <meta name="description" content="Prevent UI freezes in your Leaflet GPX app by offloading large file parsing to Web Workers, ensuring smooth user experience."> <meta name="author" content="Adrian Galera"> <!-- Open Graph / Facebook --> <meta property="og:type" content="article"> <meta property="og:url" content="https://www.agalera.eu/parsing-gpx-files-in-a-web-worker-to-keep-the-ui-responsive/"> <meta property="og:title" content="Keep the UI responsive by using web worker"> <meta property="og:description" content="Prevent UI freezes in your Leaflet GPX app by offloading large file parsing to Web Workers, ensuring smooth user experience."> <meta property="og:image" content="https://www.agalera.eu/_astro/gpx-web-worker-featured-image.J7oL4elO.webp">  <meta property="article:author" content="Adrian Galera"> <meta property="article:published_time" content="2025-03-23T23:00:00.000Z">  <!-- Twitter --> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://www.agalera.eu/parsing-gpx-files-in-a-web-worker-to-keep-the-ui-responsive/"> <meta property="twitter:title" content="Keep the UI responsive by using web worker"> <meta property="twitter:description" content="Prevent UI freezes in your Leaflet GPX app by offloading large file parsing to Web Workers, ensuring smooth user experience."> <meta property="twitter:image" content="https://www.agalera.eu/_astro/gpx-web-worker-featured-image.J7oL4elO.webp"> <!-- RSS auto-discovery --> <link rel="alternate" type="application/rss+xml" title="agalera.eu" href="/rss.xml"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script> <script type="module">const n=window.location.hostname;n.includes("agalera.eu")||(console.log("Disabling analytics..."),window["ga-disable-G-S8VGYBN25C"]=!0);window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-S8VGYBN25C");</script> <!-- Primary Meta Tags --> <title>Keep the UI responsive by using web worker • agalera.eu</title><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'dark' : 'light')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_slug_.KSlPVATJ.css"></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-8 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-4 md:p-0"> <a href="https://github.com/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://www.linkedin.com/in/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.DfCBgpPA.js"></script>  </div> <script type="module">class r extends HTMLElement{constructor(){super();const e=this.querySelector("button");e&&e.addEventListener("click",t=>{if(t.currentTarget instanceof HTMLButtonElement){let n=t.currentTarget.getAttribute("aria-pressed")==="true",s=new CustomEvent("theme-change",{detail:{theme:n?"light":"dark"}});document.dispatchEvent(s),e.setAttribute("aria-pressed",String(!n))}})}}"customElements"in window&&customElements.define("theme-toggle",r);</script> <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header> <script type="module">document.addEventListener("click",e=>{const t=document.getElementById("astro-header-drawer"),n=document.getElementById("astro-header-drawer-button");t?.contains(e.target)||n?.contains(e.target)?t?.classList.toggle("translate-x-96"):t?.classList.add("translate-x-96")});</script>  <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2025-03-23T23:00:00.000Z"> Mar 24, 2025 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 4 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Keep the UI responsive by using web worker </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/gpx" aria-label="gpx"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> gpx </span> </a><a href="/tags/vitest" aria-label="vitest"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> vitest </span> </a><a href="/tags/test" aria-label="test"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> test </span> </a><a href="/tags/web-worker" aria-label="web-worker"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> web-worker </span> </a><a href="/tags/js" aria-label="js"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> js </span> </a> </div> </header> <img src="/_astro/gpx-web-worker-featured-image.J7oL4elO_Z1TOfg3.jpg" loading="eager" alt="img of Keep the UI responsive by using web worker" width="1000" height="500" decoding="async" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://www.agalera.eu/parsing-gpx-files-in-a-web-worker-to-keep-the-ui-responsive/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.agalera.eu/parsing-gpx-files-in-a-web-worker-to-keep-the-ui-responsive/" aria-label="Share on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <h2 class="font-bold mb-3 text-2xl dark:text-white">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#web-workers" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Web Workers </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#create-the-web-worker-script" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Create the web worker script </a>  </li><li class="flex flex-col"> <a href="#integrate-the-web-worker-in-the-main-thread" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Integrate the Web Worker in the main thread </a>  </li><li class="flex flex-col"> <a href="#testing" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Testing </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#move-the-core-parsing-into-a-separate-module" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Move the core parsing into a separate module </a>  </li><li class="flex flex-col"> <a href="#write-tests-with-vitest" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Write tests with Vitest </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#final-thoughts" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Final thoughts </a>  </li> </ul> </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>GPX files, which are XML-based, can be quite large, especially when they contain extensive tracking data. Parsing these files on the main thread can block the UI, causing unresponsiveness during the parsing process.</p>
<h2 id="web-workers">Web Workers</h2>
<p>Web Workers allow us to run scripts in background threads, separate from the main execution thread of a web application. By offloading the GPX parsing to a Web Worker, we can prevent UI freezes and maintain a smooth user experience.</p>
<p>Here’s how I implemented the Web Worker to parse GPX files:</p>
<h3 id="create-the-web-worker-script">Create the web worker script</h3>
<p>First, I created a separate JavaScript file, gpx-parser-worker.js, which contains the code for parsing the GPX files:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#BABED8">self</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">onmessage</span><span style="color:#89DDFF"> =</span><span style="color:#C792EA"> function</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">event</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> gpxData</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> event</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">data</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> parser</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> new</span><span style="color:#82AAFF"> DOMParser</span><span style="color:#F07178">()</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> xmlDoc</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> parser</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">parseFromString</span><span style="color:#F07178">(</span><span style="color:#BABED8">gpxData</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">application/xml</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> trackPoints</span><span style="color:#89DDFF"> =</span><span style="color:#F07178"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> trkpts</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> xmlDoc</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getElementsByTagName</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">trkpt</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	for</span><span style="color:#F07178"> (</span><span style="color:#C792EA">let</span><span style="color:#BABED8"> i</span><span style="color:#89DDFF"> =</span><span style="color:#F78C6C"> 0</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> i</span><span style="color:#89DDFF"> &#x3C;</span><span style="color:#BABED8"> trkpts</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">length</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> i</span><span style="color:#89DDFF">++</span><span style="color:#F07178">) </span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> trkpt</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> trkpts</span><span style="color:#F07178">[</span><span style="color:#BABED8">i</span><span style="color:#F07178">]</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> lat</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> parseFloat</span><span style="color:#F07178">(</span><span style="color:#BABED8">trkpt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getAttribute</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">lat</span><span style="color:#89DDFF">'</span><span style="color:#F07178">))</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> lon</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> parseFloat</span><span style="color:#F07178">(</span><span style="color:#BABED8">trkpt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getAttribute</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">lon</span><span style="color:#89DDFF">'</span><span style="color:#F07178">))</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> ele</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> parseFloat</span><span style="color:#F07178">(</span><span style="color:#BABED8">trkpt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getElementsByTagName</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">ele</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)[</span><span style="color:#F78C6C">0</span><span style="color:#F07178">]</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">textContent</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> time</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> trkpt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getElementsByTagName</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">time</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)[</span><span style="color:#F78C6C">0</span><span style="color:#F07178">]</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">textContent</span></span>
<span class="line"><span style="color:#BABED8">		trackPoints</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">push</span><span style="color:#F07178">(</span><span style="color:#89DDFF">{</span><span style="color:#BABED8"> lat</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> lon</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> ele</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> time</span><span style="color:#89DDFF"> }</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">	self</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">postMessage</span><span style="color:#F07178">(</span><span style="color:#BABED8">trackPoints</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>
<p>In this script, the worker listens for messages containing GPX data, parses the XML to extract track points, and sends the parsed data back to the main thread.</p>
<h3 id="integrate-the-web-worker-in-the-main-thread">Integrate the Web Worker in the main thread</h3>
<p>In the main JavaScript file of the application, I integrated the Web Worker as follows:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#676E95;font-style:italic">// Initialize the Web Worker</span></span>
<span class="line"><span style="color:#C792EA">const</span><span style="color:#BABED8"> gpxParserWorker </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> new</span><span style="color:#82AAFF"> Worker</span><span style="color:#BABED8">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">gpx-parser-worker.js</span><span style="color:#89DDFF">'</span><span style="color:#BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">// Handle messages received from the worker</span></span>
<span class="line"><span style="color:#BABED8">gpxParserWorker</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">onmessage</span><span style="color:#89DDFF"> =</span><span style="color:#C792EA"> function</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">event</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> trackPoints</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> event</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">data</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Process the track points, e.g., add them to the Leaflet map</span></span>
<span class="line"><span style="color:#82AAFF">	addTrackToMap</span><span style="color:#F07178">(</span><span style="color:#BABED8">trackPoints</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>
<p>In this setup, the main thread initializes the Web Worker and defines a handler for messages received from the worker. When a GPX file is loaded, its contents are sent to the worker for parsing. Once parsing is complete, the worker sends the parsed track points back to the main thread for further processing, such as rendering them on the Leaflet map.</p>
<p>Since I’m using vite, I needed to change the registration of the web worker a bit:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#89DDFF">new</span><span style="color:#82AAFF"> Worker</span><span style="color:#BABED8">(</span><span style="color:#89DDFF">new</span><span style="color:#82AAFF"> URL</span><span style="color:#BABED8">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">./gpx-worker.js</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF;font-style:italic"> import</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">meta</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">url))</span></span></code></pre>
<p>Doing it this way, I was able to import the worker without needing any extra config</p>
<h3 id="testing">Testing</h3>
<p>The trick with testing Web Workers is that you don’t spin up an actual thread. Instead, you isolate the parsing logic into a function that can be tested independently.</p>
<h4 id="move-the-core-parsing-into-a-separate-module">Move the core parsing into a separate module</h4>
<p>I created parse-gpx.js to hold the core logic:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#676E95;font-style:italic">// parse-gpx.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">export</span><span style="color:#C792EA"> function</span><span style="color:#82AAFF"> parseGPX</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">xmlString</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> parser</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> new</span><span style="color:#82AAFF"> DOMParser</span><span style="color:#F07178">()</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> xmlDoc</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> parser</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">parseFromString</span><span style="color:#F07178">(</span><span style="color:#BABED8">xmlString</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">application/xml</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	return</span><span style="color:#BABED8"> Array</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">from</span><span style="color:#F07178">(</span><span style="color:#BABED8">xmlDoc</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getElementsByTagName</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">trkpt</span><span style="color:#89DDFF">'</span><span style="color:#F07178">))</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">map</span><span style="color:#F07178">(</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">pt</span><span style="color:#89DDFF">)</span><span style="color:#C792EA"> =></span><span style="color:#F07178"> (</span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#F07178">		lat</span><span style="color:#89DDFF">:</span><span style="color:#82AAFF"> parseFloat</span><span style="color:#F07178">(</span><span style="color:#BABED8">pt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getAttribute</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">lat</span><span style="color:#89DDFF">'</span><span style="color:#F07178">))</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#F07178">		lon</span><span style="color:#89DDFF">:</span><span style="color:#82AAFF"> parseFloat</span><span style="color:#F07178">(</span><span style="color:#BABED8">pt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getAttribute</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">lon</span><span style="color:#89DDFF">'</span><span style="color:#F07178">))</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#F07178">		ele</span><span style="color:#89DDFF">:</span><span style="color:#82AAFF"> parseFloat</span><span style="color:#F07178">(</span><span style="color:#BABED8">pt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getElementsByTagName</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">ele</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)[</span><span style="color:#F78C6C">0</span><span style="color:#F07178">]</span><span style="color:#89DDFF">?.</span><span style="color:#BABED8">textContent</span><span style="color:#89DDFF"> ||</span><span style="color:#F78C6C"> 0</span><span style="color:#F07178">)</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#F07178">		time</span><span style="color:#89DDFF">:</span><span style="color:#BABED8"> pt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">getElementsByTagName</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">time</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)[</span><span style="color:#F78C6C">0</span><span style="color:#F07178">]</span><span style="color:#89DDFF">?.</span><span style="color:#BABED8">textContent</span></span>
<span class="line"><span style="color:#89DDFF">	}</span><span style="color:#F07178">))</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>
<p>Then, gpx-worker.js simply uses it:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#89DDFF"> {</span><span style="color:#BABED8"> parseGPX</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF;font-style:italic"> from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">./parse-gpx.js</span><span style="color:#89DDFF">'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">self</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">onmessage</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">e</span><span style="color:#89DDFF">)</span><span style="color:#C792EA"> =></span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> parsed</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> parseGPX</span><span style="color:#F07178">(</span><span style="color:#BABED8">e</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">data</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#BABED8">	self</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">postMessage</span><span style="color:#F07178">(</span><span style="color:#BABED8">parsed</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>
<h4 id="write-tests-with-vitest">Write tests with Vitest</h4>
<p>Thanks to <a href="https://www.npmjs.com/package/@vitest/web-worker" title="vitest web worker">vitest-web-worker module</a>, you can use vitest as you’d use it regularly. The only different thing you need to do is just to import and create a new instance of your web worker:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">@vitest/web-worker</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#89DDFF"> {</span><span style="color:#BABED8"> describe</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> it</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> expect</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF;font-style:italic"> from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">vitest</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> fs </span><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">fs</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> path </span><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">path</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> GpxParserWorker </span><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">../../../src/parser/trackparser.worker?worker</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#89DDFF"> {</span><span style="color:#BABED8"> waitFor</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF;font-style:italic"> from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">@testing-library/dom</span><span style="color:#89DDFF">'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">describe</span><span style="color:#BABED8">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">GPX Parser Worker</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> ()</span><span style="color:#C792EA"> =></span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">	const</span><span style="color:#BABED8"> validGpxData</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> ()</span><span style="color:#C792EA"> =></span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> filePath</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> path</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">resolve</span><span style="color:#F07178">(</span><span style="color:#BABED8">__dirname</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">../../resources/test-track.gpx</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">		return</span><span style="color:#BABED8"> fs</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">readFileSync</span><span style="color:#F07178">(</span><span style="color:#BABED8">filePath</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">utf-8</span><span style="color:#89DDFF">'</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">	it</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">should parse GPX data correctly</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#C792EA"> async</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">done</span><span style="color:#89DDFF">)</span><span style="color:#C792EA"> =></span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">		const</span><span style="color:#BABED8"> worker</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> new</span><span style="color:#82AAFF"> GpxParserWorker</span><span style="color:#F07178">()</span></span>
<span class="line"><span style="color:#C792EA">		let</span><span style="color:#BABED8"> recivedData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">		worker</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">onmessage</span><span style="color:#89DDFF"> =</span><span style="color:#C792EA"> function</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">event</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">			recivedData</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> event</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">data</span></span>
<span class="line"><span style="color:#89DDFF">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">		worker</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">postMessage</span><span style="color:#F07178">(</span><span style="color:#89DDFF">{</span><span style="color:#F07178"> id</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">12345</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#F07178"> file</span><span style="color:#89DDFF">:</span><span style="color:#82AAFF"> validGpxData</span><span style="color:#F07178">() </span><span style="color:#89DDFF">}</span><span style="color:#F07178">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">		await</span><span style="color:#82AAFF"> waitFor</span><span style="color:#F07178">(</span><span style="color:#89DDFF">()</span><span style="color:#C792EA"> =></span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#82AAFF">			expect</span><span style="color:#F07178">(</span><span style="color:#BABED8">recivedData</span><span style="color:#F07178">)</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">toEqual</span><span style="color:#F07178">([</span></span>
<span class="line"><span style="color:#89DDFF">				{</span><span style="color:#F07178"> lat</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 48.8588443</span><span style="color:#89DDFF">,</span><span style="color:#F07178"> lon</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 2.2943506</span><span style="color:#89DDFF"> },</span></span>
<span class="line"><span style="color:#89DDFF">				{</span><span style="color:#F07178"> lat</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 48.859</span><span style="color:#89DDFF">,</span><span style="color:#F07178"> lon</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 2.295</span><span style="color:#89DDFF"> }</span></span>
<span class="line"><span style="color:#F07178">			])</span></span>
<span class="line"><span style="color:#89DDFF">		}</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">	}</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">}</span><span style="color:#BABED8">)</span></span></code></pre>
<p>The test reads the contents of a real GPX track, and send them to the worker, then, the test waits for the result of the web worker.</p>
<p>Pay extra attention to the import line:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#89DDFF;font-style:italic">import</span><span style="color:#BABED8"> GpxParserWorker </span><span style="color:#89DDFF;font-style:italic">from</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">../../../src/parser/trackparser.worker?worker</span><span style="color:#89DDFF">'</span></span></code></pre>
<p>Make sure to include the suffix <code>?worker</code>, otherwise <code>vite</code> will not recognize the file as a worker and the test will fail.</p>
<h3 id="final-thoughts">Final thoughts</h3>
<p>Offloading GPX file parsing to a Web Worker is an effective strategy to maintain UI responsiveness in web applications that handle large GPX files. This method ensures that computationally intensive tasks do not interfere with user interactions, resulting in a smoother and more enjoyable experience.</p>
<p>Got questions or want to see the full code? Drop me a message or check out the <a href="https://github.com/adriangalera/estuve" title="estuve">project</a> on GitHub.</p> </div> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2"> 2025 Adrian Galera
</footer> </main>    </body> </html> <script type="module">const t=()=>{function r(o,a){o.forEach(s=>{const e=document.querySelector(`aside a[href="#${s.target.id}"]`);s.isIntersecting?(e?.classList.remove("bg-slate-200","dark:bg-slate-800"),e?.classList.add("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200")):(e?.classList.add("bg-slate-200","dark:bg-slate-800"),e?.classList.remove("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200"))})}const i=document.querySelectorAll("div.prose h1, div.prose h2, div.prose h3, div.prose h4, div.prose h5, div.prose h6"),n={root:null,rootMargin:" 15% 0px 0% 0px ",threshold:1},d=new IntersectionObserver(r,n);i.forEach(o=>{d.observe(o)})};t();document.addEventListener("astro:after-swap",t);</script>