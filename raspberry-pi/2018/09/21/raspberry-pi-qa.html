<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.3
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    <!-- Theme Mode-->
    
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/img/avatars/me-100x100.png" type="image/x-icon">

    

    <!-- KaTeX 0.15.2 -->
    
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    <!-- Mermaid 9.1.1 -->
    
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({
      startOnLoad:true,
      theme: 'default',
    });"></script>
    

    <!-- Simple Jekyll Search 1.10.0 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://www.agalera.eu';
      const isCookieConsent = 'false';
      const analyticsName = 'UA-126206451-1';
      const analyticsNameGA4 = '';
    </script>

    
    
        <!-- Global site tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-126206451-1"></script>
        <!-- Page analysis (analytics.js) -->
        <script async src='https://www.google-analytics.com/analytics.js'></script>
    

    <!-- seo tags -->
    <meta property="og:image" content="https://www.agalera.eu/assets/img/posts/rpiqa/featured-image.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Raspberry Pi for QA | Adrian Galera blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Raspberry Pi for QA" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The design and implementation of multiple QA services (Network tweaking, VPN, Packet analysis,..) on a NodeJS server on a Raspberry Pi" />
<meta property="og:description" content="The design and implementation of multiple QA services (Network tweaking, VPN, Packet analysis,..) on a NodeJS server on a Raspberry Pi" />
<link rel="canonical" href="https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html" />
<meta property="og:url" content="https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html" />
<meta property="og:site_name" content="Adrian Galera blog" />
<meta property="og:image" content="https://www.agalera.eu/assets/img/posts/rpiqa/featured-image.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-21T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.agalera.eu/assets/img/posts/rpiqa/featured-image.jpg" />
<meta property="twitter:title" content="Raspberry Pi for QA" />
<script type="application/ld+json">
{"headline":"Raspberry Pi for QA","dateModified":"2018-09-21T00:00:00+02:00","datePublished":"2018-09-21T00:00:00+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html"},"url":"https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html","description":"The design and implementation of multiple QA services (Network tweaking, VPN, Packet analysis,..) on a NodeJS server on a Raspberry Pi","image":"https://www.agalera.eu/assets/img/posts/rpiqa/featured-image.jpg","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Adrian Galera blog" href="https://www.agalera.eu/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://www.agalera.eu/feed.xml" title="Adrian Galera blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Raspberry Pi for QA">
    <meta name="twitter:description" content="On a previous company the QA team needed to perform some scenarios that were difficult to reproduce, for instance force a buffering event. Their setup requir...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://www.agalera.eu/assets/img/posts/rpiqa/featured-image.jpg">
    <meta name="twitter:image:alt" content="Raspberry Pi for QA">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/assets/img/avatars/me-100x100.png" />
		</a>
        
        <a class="site-title" aria-label="Adrian Galera blog" href="/">
        Adrian Galera blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Raspberry Pi for QA " aria-label="Raspberry Pi for QA" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Raspberry+Pi+for+QA" class="title">Raspberry Pi for QA</h1>
      


<div class="post-info">
    <p class="meta">
      
      
      September 21, 2018
    </p></div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>On a previous company the QA team needed to perform some scenarios that were difficult to reproduce, for instance force a buffering event. Their setup require deep technical understanding of Linux. In order to ease its world, I decided to create a neat service running on a Raspberry Pi.</p>
<p><!--more--></p>
<h2>The problems:</h2>
<p>Concretely, the scenarios that the QA needed to cover were:</p>
<h3><a href="#network-performance"><em>Restrict the network performance</em></a></h3>
<p>The test that the QA team were performing, included provoking buffering issues in media players. They found issues on how this could be achieved: in Chrome it could be achieved through Developer Tools, but what about mobile devices, or even worst: some weird embedded media players?</p>
<h3><a href="#geoblock"><em>Access Geo-blocked content</em></a></h3>
<p>Since the company had customers world-wide and some of them used Geo-blocked content, they need to access those contents through the use of VPNs. This required spending some time configuration the VPN clients on their side</p>
<h3><a href="#ipblock"><em>IP Blocking</em></a></h3>
<p>There were some scenarios (I cannot remember right now) that required to block the connection to some IP. This is really easy to do on a UNIX machine with iptables, but good luck doing that on Windows.</p>
<h3><a href="#dnsspoof"><em>Modify DNS records</em></a></h3>
<p>It were some scenario where they needed to change the DNS records. For instance: www.google.com -&gt; 192.168.1.100. I don't remember the rationale to this requirement :(</p>
<h3><a href="#httpssniffer"><i>Analyse</i><em> HTTPS traffic</em></a></h3>
<p>In the majority of the environments the connections with the company server's were made with HTTPS. This caused a little bit of headache while analysing the HTTP traffic.</p>
<h2>The solutions ...</h2>
<p>Since most of the scenarios require some networking tweaks, the obvious decision was Linux, even better: Raspberry Pi. The project consist in a NodeJS Express application that executed scripts on the RaspberryPi.</p>
<p>The raspberry PI have two network interfaces: the LAN and the WiFi. The configuration is setup in the interfaces file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auto lo
iface lo inet loopback
auto eth0
auto wlan0
#static ethernet conf
iface eth0 inet static
address 192.168.1.100
netmask 255.255.255.0
gateway	192.168.1.1
dns-nameservers 8.8.4.4
iface wlan0 inet static
address 192.168.150.1
netmask 255.255.255.0
</code></pre></div></div>

<p>In the WiFi interface hostapd service is configured in order to serve a WiFi connection. This will configure the traffic outgoing traffic from wlan0 to eth0.</p>
<h3>Playing with tc and ifb</h3>
<p>The network performance restrictions can be applied using the tc command and the ifb module on Linux. This module redirects the traffic from one real network interface to a virtual one. When the traffic passes through the ifb0 interface the token bucket (<a href="https://en.wikipedia.org/wiki/Token_bucket#Hierarchical_token_bucket">htb</a>) applies the network configuration</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Enable ifb module and setup the ifb0 interface
modprobe ifb numifbs=1 &amp;amp;&amp;amp; ip link set dev ifb0 up
#Create a device that redirects all the traffic
#from eth0 to ifb0
tc qdisc add dev eth0 handle ffff: ingress &amp;amp;&amp;amp; \
tc filter add dev eth0 parent ffff: protocol ip u32 \
match u32 0 0 action mirred egress redirect dev ifb0
#Modify the token bucket configuration
tc qdisc add dev ifb0 root handle 1: htb default 10 &amp;amp;&amp;amp; \
tc class add dev ifb0 parent 1: classid 1:1 htb rate 1mb &amp;amp;&amp;amp; \
tc class add dev ifb0 parent 1:1 classid 1:10 htb rate 1mb
</code></pre></div></div>

<h3>OpenVPN and Iptables</h3>
<p>In order to be able to avoid the Geo-blocking of contents, the company provide us a commercial VPN. This consisted on a series of OpenVPN configuration scripts for multiple countries. Therefore, the app only needs to call openvpn:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openvpn ALBANIA-TCP.ovpn
</code></pre></div></div>

<p>It's really easy to block an IP on a Linux box, the app only needs to call the iptables, for example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -I FORWARD -s 192.168.150.0/24 -d 8.8.8.8  -j DROP
</code></pre></div></div>

<p>This snippet blocks the outgoing connections to 8.8.8.8 that goes out from the WiFi network</p>
<h3>Networking stuff ...</h3>
<p id="dnsspoof">Regarding DNS Spoofing, it's a little bit trickier, however the <strong>dnsmasq</strong> service is very useful in that situation.</p>

<p><a href="/assets/img/posts/rpiqa/dnsmasq.png"><img src="/assets/img/posts/rpiqa/dnsmasq.png" alt="dnsmasq schema" /></a>
<em>dnsmasq schema</em></p>

<p>The clients connected to the WiFi will resolve the DNS queries thanks to the dnsmasq client listening to incoming connections. This service is able to perform custom DNS resolutions based on a file that works like a /etc/hosts file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>192.168.56.1   ubuntu.tecmint.lan
192.168.56.10  centos.tecmint.lan
</code></pre></div></div>

<p id="httpssniffer">Regarding the HTTPS Sniffer, the implemented solution implies having the SSL certificates from the company installed in a reverse proxy that terminates the SSL connection and forwards the HTTP traffic to an internal server that stores the decrypted requests on a cache.</p>

<p><a href="/assets/img/posts/rpiqa/httpsproxy.png"><img src="/assets/img/posts/rpiqa/httpsproxy.png" alt="https proxy setup" /></a>
<em>dnsmasq schema</em></p>

<p>This cache can be queried from the GUI to inspect the requests. There's an additional implementation that allows to run pcap capture software directly on the network interface to inspect the packets from the UI.</p>
<p>This environment requires a little setup, that is the configuration of the proxy on the computers of the QA team.</p>
<p>Finally, the QA team were able to save a lot of time setting up their scenarios. With this app it's only a matter of clicking buttons instead of executing weird scripts</p>
<h2>The code ...</h2>
<p>Don't blame too much on the code quality: the whole project was implemented few years ago and as a side project on one or two weekends</p>
<p><a href="https://github.com/adriangalera/rpitester">https://github.com/adriangalera/rpitester</a></p>
<p>Here's a video of me presenting that project ;)</p>
<p><iframe src="https://www.youtube.com/embed/aUaEF87pdms?rel=0&amp;showinfo=0" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
        
        <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html" target="_blank"
               title=" Facebook">
                <i class="fab fa-facebook-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Facebook</span>
            </a>
        </li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Raspberry+Pi+for+QA%20https%3A%2F%2Fwww.agalera.eu%2Fraspberry-pi%2F2018%2F09%2F21%2Fraspberry-pi-qa.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
         
        <li>
            <a href="https://www.tumblr.com/share?v=3&u=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html&quote=Raspberry+Pi+for+QA%20%7C%20Adrian+Galera+blog&s="
               target="_blank" title=" Tumblr">
                <i class="fab fa-tumblr-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Tumblr</span>
            </a>
        </li>
         
        <li>
            <a href="https://pinterest.com/pin/create/button/?url=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html&media=https://www.agalera.eu/assets/img/posts/rpiqa/featured-image.jpg$description=On+a+previous+company+the+QA+team+needed+to+perform+some+scenarios+that+were+difficult+to+reproduce%2C+for+instance+force+a+buffering+event.+Their+setup%C2%A0require+deep+technical+understanding+of+Linux.+In+order+to+ease+its+world%2C+I+decided+to+create+a+neat+service+running+on+a+Raspberry+Pi.%0A%0A%0A"
               target="_blank" title="">
                <i class="fab fa-pinterest-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Pin it</span>
            </a>
        </li>
          
        <li>
            <a href="https://www.reddit.com/submit?url=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html&title=Raspberry+Pi+for+QA%20%7C%20Adrian+Galera+blog"
               target="_blank" title=" Reddit">
                <i class="fab fa-reddit-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Reddit</span>
            </a>
        </li>
         
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html&title=Raspberry+Pi+for+QA%20%7C%20Adrian+Galera+blog&summary=&source=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Raspberry Pi for QA%20%7C%20Adrian Galera blog&body=https://www.agalera.eu/raspberry-pi/2018/09/21/raspberry-pi-qa.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#linux">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> linux</p>
        </a></li>
      
        <li><a class="button" href="/tags#nodejs">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> nodejs</p>
        </a></li>
      
        <li><a class="button" href="/tags#qa">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> qa</p>
        </a></li>
      
        <li><a class="button" href="/tags#raspberry-pi">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> raspberry-pi</p>
        </a></li>
      
        <li><a class="button" href="/tags#testing">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> testing</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Timeseries database with DynamoDB" href="/aws/2018/09/21/timeseries-db-dynamodb.html">
            <p>Previous post</p>
            Timeseries database with DynamoDB
        </a>
    </div>
    

    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/assets/img/posts/rpiqa/featured-image.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        </p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/adriangalera"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/in/adriangalera"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    
        
        
        
        
        <li>
            <a href="mailto:adrian.galera.87@gmail.com"
               title="Follow on Mail"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


                </ul>
            </div>
</footer>



  </body>
</html>
