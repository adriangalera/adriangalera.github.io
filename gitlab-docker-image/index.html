<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BZs-2RF_.js"></script> <!-- Global Metadata --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <meta name="generator" content="Astro v5.6.2"> <!-- Canonical URL --> <link rel="canonical" href="https://www.agalera.eu/gitlab-docker-image/"> <!-- SEO --> <meta name="title" content="Gitlab improvements: caches and Docker • agalera.eu"> <meta name="description" content="This post describe how I can manage to reduce the time consumed by Gitlab pipelines by caching the dependencies and using Docker images"> <meta name="author" content="Adrian Galera"> <!-- Open Graph / Facebook --> <meta property="og:type" content="article"> <meta property="og:url" content="https://www.agalera.eu/gitlab-docker-image/"> <meta property="og:title" content="Gitlab improvements: caches and Docker"> <meta property="og:description" content="This post describe how I can manage to reduce the time consumed by Gitlab pipelines by caching the dependencies and using Docker images"> <meta property="og:image" content="https://www.agalera.eu/_astro/featured.DpSOeGZ3.jpg">  <meta property="article:author" content="Adrian Galera"> <meta property="article:published_time" content="2020-05-22T00:00:00.000Z">  <!-- Twitter --> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://www.agalera.eu/gitlab-docker-image/"> <meta property="twitter:title" content="Gitlab improvements: caches and Docker"> <meta property="twitter:description" content="This post describe how I can manage to reduce the time consumed by Gitlab pipelines by caching the dependencies and using Docker images"> <meta property="twitter:image" content="https://www.agalera.eu/_astro/featured.DpSOeGZ3.jpg"> <!-- RSS auto-discovery --> <link rel="alternate" type="application/rss+xml" title="agalera.eu" href="/rss.xml"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script> <script type="module">const n=window.location.hostname;n.includes("agalera.eu")||(console.log("Disabling analytics..."),window["ga-disable-G-S8VGYBN25C"]=!0);window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-S8VGYBN25C");</script> <!-- Primary Meta Tags --> <title>Gitlab improvements: caches and Docker • agalera.eu</title><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'dark' : 'light')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_slug_.KSlPVATJ.css"></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-8 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-4 md:p-0"> <a href="https://github.com/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://www.linkedin.com/in/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.DfCBgpPA.js"></script>  </div> <script type="module">class r extends HTMLElement{constructor(){super();const e=this.querySelector("button");e&&e.addEventListener("click",t=>{if(t.currentTarget instanceof HTMLButtonElement){let n=t.currentTarget.getAttribute("aria-pressed")==="true",s=new CustomEvent("theme-change",{detail:{theme:n?"light":"dark"}});document.dispatchEvent(s),e.setAttribute("aria-pressed",String(!n))}})}}"customElements"in window&&customElements.define("theme-toggle",r);</script> <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header> <script type="module">document.addEventListener("click",e=>{const t=document.getElementById("astro-header-drawer"),n=document.getElementById("astro-header-drawer-button");t?.contains(e.target)||n?.contains(e.target)?t?.classList.toggle("translate-x-96"):t?.classList.add("translate-x-96")});</script>  <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2020-05-22T00:00:00.000Z"> May 22, 2020 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 7 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Gitlab improvements: caches and Docker </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/devops" aria-label="devops"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> devops </span> </a><a href="/tags/ci/cd" aria-label="ci/cd"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> ci/cd </span> </a><a href="/tags/gitlab" aria-label="gitlab"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> gitlab </span> </a><a href="/tags/react" aria-label="react"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> react </span> </a><a href="/tags/docker" aria-label="docker"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> docker </span> </a><a href="/tags/frontend" aria-label="frontend"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> frontend </span> </a> </div> </header> <img src="/_astro/featured.DpSOeGZ3_Z1wrXmD.jpg" loading="eager" alt="img of Gitlab improvements: caches and Docker" width="1000" height="500" decoding="async" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://www.agalera.eu/gitlab-docker-image/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.agalera.eu/gitlab-docker-image/" aria-label="Share on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <h2 class="font-bold mb-3 text-2xl dark:text-white">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#scenario" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Scenario </a>  </li><li class="flex flex-col"> <a href="#basic-pipeline" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Basic pipeline </a>  </li><li class="flex flex-col"> <a href="#caching-node_modules" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Caching node_modules </a>  </li><li class="flex flex-col"> <a href="#using-docker-image" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Using Docker image </a>  </li><li class="flex flex-col"> <a href="#wrap-up" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Wrap up </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#total" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Total </a>  </li><li class="flex flex-col"> <a href="#jobs" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Jobs </a>  </li> </ul> </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>Gitlab or any other CI/CD system works really great to have an automated build system. However, you can waste lots of time if you don’t think about carefully. Every job needs to download the build tools and dependencies, so that’s a lot of time that could be reduced.</p>
<p>In this article I describe two techniques to avoid wasting that much time. First one is using a cache for the dependencies and the second is using a pre-built Docker image with the required build tools.</p>
<h2 id="scenario">Scenario</h2>
<p>We will be building a simple react application to be deployed into an S3 Bucket. This simple react application contains a bunch of npm dependencies to simulate a real application. You can find the code here: <a href="https://gitlab.com/adrian.galera/gitlab-docker-react"></a><a href="https://gitlab.com/adrian.galera/gitlab-docker-react">https://gitlab.com/adrian.galera/gitlab-docker-react</a>.</p>
<p>To simulate a real work environment, let’s define a pipeline consisting in three steps:</p>
<ul>
<li>test: runs the tests defined in the project</li>
<li>build: produce the artifact to be deployed</li>
<li>deploy: deploy the artifact to an AWS S3 Bucket</li>
</ul>
<h2 id="basic-pipeline">Basic pipeline</h2>
<p>In this basic pipeline, no cache nor Docker is configured. Each job needs to download everything:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#F07178">test frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> node:12.13-alpine</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> test</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm install</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">build frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> node:12.13-alpine</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> build</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm install</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm build</span></span>
<span class="line"><span style="color:#F07178">  only</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">deploy frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> node:12.13-alpine</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> deploy</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> apk add python curl build-base zip</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> unzip -o awscli-bundle.zip</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> aws --version</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> aws s3 sync build s3://random-bucket</span></span>
<span class="line"><span style="color:#F07178">  only</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> master</span></span></code></pre>
<p><code>test</code> and <code>build</code> jobs use a nodejs Docker image and install all the dependencies and run the scripts. <code>deploy</code> job uses the same image and downloads and install the awsclient in order to upload the built artifact to a S3 bucket.</p>
<p>Next step is to measure the time:</p>

















<table><thead><tr><th>Test</th><th>Build</th><th>Deploy</th><th>Total</th></tr></thead><tbody><tr><td>1m 24s</td><td>1m 26s</td><td>57 s</td><td>3m 48 s</td></tr></tbody></table>
<p>That’s a lot of time wasted downloading dependencies or installing tools. In the next section we will reduce it by using caches</p>
<h2 id="caching-node_modules">Caching node_modules</h2>
<p>We can use Gitlab cache feature to keep the contents of the node_modules folder instead of downloading them every time. It’s really simple to set it up:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#F07178">stages</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">  -</span><span style="color:#C3E88D"> test</span></span>
<span class="line"><span style="color:#89DDFF">  -</span><span style="color:#C3E88D"> build</span></span>
<span class="line"><span style="color:#89DDFF">  -</span><span style="color:#C3E88D"> deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">test frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> node:12.13-alpine</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> test</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm ci --cache .npm --prefer-offline</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm test</span></span>
<span class="line"><span style="color:#F07178">  cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">    paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> .npm/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">build frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> node:12.13-alpine</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> build</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm ci --cache .npm --prefer-offline</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm build</span></span>
<span class="line"><span style="color:#F07178">  only</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> master</span></span>
<span class="line"><span style="color:#F07178">  cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">    paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> .npm/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">deploy frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> node:12.13-alpine</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> deploy</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> apk add python curl build-base zip</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> unzip -o awscli-bundle.zip</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> aws --version</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> aws s3 sync build s3://random-bucket</span></span>
<span class="line"><span style="color:#F07178">  only</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> master</span></span>
<span class="line"><span style="color:#F07178">  cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">    paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> .npm/</span></span></code></pre>
<p>We only need to tell <code>npm</code> to work with the cache with this line:</p>
<p><code>npm ci --cache .npm --prefer-offline</code> instead of the traditional <code>npm install</code></p>
<p>and configure the cache in each job:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#F07178">cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">  paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> .npm/</span></span></code></pre>
<p>We are telling gitlab to store the <code>.npm</code> folder in the cache named <code>node-modules</code></p>
<p>The time improvement can observed in the following table:</p>

















<table><thead><tr><th>Test</th><th>Build</th><th>Deploy</th><th>Total</th></tr></thead><tbody><tr><td>1m 3s</td><td>57s</td><td>56s</td><td>2m 54s</td></tr></tbody></table>
<p>We can observe a huge decrease in the <code>test</code> and <code>build</code> jobs. The time spent on deploy is pretty similar to the one before.</p>
<h2 id="using-docker-image">Using Docker image</h2>
<p>The <code>deploy</code> job is downloading and installing the awsclient to upload the built artifact to S3 bucket. We could improve that time by using a Docker image which already contains
the awslcient. In order to do so, we can build our own image and store it in Gitlab Container Registry. The Container registry can be found in the side bar: <code>Packages &#x26; Resgistries -> Container Registry</code></p>
<p>We will build an image with nodejs 12:13 and the aws client. In order to do so, we will use the following Dockerfile:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>FROM node:12.13-alpine</span></span>
<span class="line"><span>RUN apk add python curl build-base zip</span></span>
<span class="line"><span>RUN curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"</span></span>
<span class="line"><span>RUN unzip -o awscli-bundle.zip</span></span>
<span class="line"><span>RUN ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws</span></span>
<span class="line"><span>RUN aws --version</span></span></code></pre>
<p>Basically, the Dockerfile is running the same commands as the pipeline, but only once. Once is the image is built, we push it to the registry and we start using it. No need to install anything!</p>
<p>To build and push the image, you only need to run the following commands:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> login</span><span style="color:#C3E88D"> registry.gitlab.com</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> build</span><span style="color:#C3E88D"> -t</span><span style="color:#C3E88D"> registry.gitlab.com/</span><span style="color:#89DDFF">&#x3C;</span><span style="color:#C3E88D">use</span><span style="color:#BABED8">r</span><span style="color:#89DDFF">></span><span style="color:#C3E88D">/</span><span style="color:#89DDFF">&#x3C;</span><span style="color:#C3E88D">projec</span><span style="color:#BABED8">t</span><span style="color:#89DDFF">></span><span style="color:#C3E88D">/node_python_aws</span><span style="color:#C3E88D"> .</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> push</span><span style="color:#C3E88D"> registry.gitlab.com/</span><span style="color:#89DDFF">&#x3C;</span><span style="color:#C3E88D">use</span><span style="color:#BABED8">r</span><span style="color:#89DDFF">></span><span style="color:#C3E88D">/</span><span style="color:#89DDFF">&#x3C;</span><span style="color:#C3E88D">projec</span><span style="color:#BABED8">t</span><span style="color:#89DDFF">></span><span style="color:#C3E88D">/node_python_aws</span></span></code></pre>
<p>Once is pushed we can use it in the pipeline in combination with the cache:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#F07178">stages</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">  -</span><span style="color:#C3E88D"> test</span></span>
<span class="line"><span style="color:#89DDFF">  -</span><span style="color:#C3E88D"> build</span></span>
<span class="line"><span style="color:#89DDFF">  -</span><span style="color:#C3E88D"> deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">test frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> registry.gitlab.com/&#x3C;user>/&#x3C;project>/node_python_aws</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> test</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm ci --cache .npm --prefer-offline</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm test</span></span>
<span class="line"><span style="color:#F07178">  cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">    paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> .npm/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">build frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> registry.gitlab.com/&#x3C;user>/&#x3C;project>/node_python_aws</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> build</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm ci --cache .npm --prefer-offline</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> npm build</span></span>
<span class="line"><span style="color:#F07178">  only</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> master</span></span>
<span class="line"><span style="color:#F07178">  cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">    paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> .npm/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">deploy frontend</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  image</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> registry.gitlab.com/&#x3C;user>/&#x3C;project>/node_python_aws</span></span>
<span class="line"><span style="color:#F07178">  stage</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> deploy</span></span>
<span class="line"><span style="color:#F07178">  script</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> aws s3 sync build s3://random-bucket</span></span>
<span class="line"><span style="color:#F07178">  only</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">    -</span><span style="color:#C3E88D"> master</span></span>
<span class="line"><span style="color:#F07178">  cache</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    key</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">node-modules</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#F07178">    paths</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> .npm/</span></span></code></pre>
<p>Note that in the <code>deploy</code> job, we’re only using the aws command directly.</p>
<p>We can notice and decrease in time on the deploy pipeline, as we were expecting:</p>

















<table><thead><tr><th>Test</th><th>Build</th><th>Deploy</th><th>Total</th></tr></thead><tbody><tr><td>1m 9s</td><td>1m 2s</td><td>35s</td><td>2m 46s</td></tr></tbody></table>
<p>The decrease of time, might not look like it’s very big, but that’s because that’s a very simple example.</p>
<p>For bigger projects, the improvements can be huge, since there are lots of dependencies and build tools that could be cached or pre-installed</p>
<h2 id="wrap-up">Wrap up</h2>
<p>We have seen different techniques to speedup Gitlab pipeline: using caches for dependencies and Docker image to pre-install build tools.</p>
<p>You can find the comparisson tables of the different approaches hereunder:</p>

































<table><thead><tr><th>Improvement</th><th>Test</th><th>Build</th><th>Deploy</th><th>Total</th></tr></thead><tbody><tr><td>None</td><td>1m 24s</td><td>1m 26s</td><td>57s</td><td>3m 48s</td></tr><tr><td>Cache</td><td>1m 3s</td><td>57s</td><td>56s</td><td>2m 54s</td></tr><tr><td>Cache + Docker</td><td>1m 9s</td><td>1m 2s</td><td>35s</td><td>2m 46s</td></tr></tbody></table>
<h3 id="total">Total</h3>
<div style="height: 400px">
<canvas id="total-results"></canvas>
</div>
<h3 id="jobs">Jobs</h3>
<div class="results-job">
    <div style="height: 400px">
    <canvas id="test-results"></canvas>
    </div>
    <div style="height: 400px">
    <canvas id="build-results"></canvas>
    </div>
    <div style="height: 400px">
    <canvas id="deploy-results"></canvas>
    </div>
</div>
<p>In the charts separated by job, we can see that the time improvement for test and build comes from using caches. Regarding deploy job, the big improvement comes we have pre-installed aws client provided by the Docker image.</p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
<script>
new Chart( "total-results", {
    type: 'bar',
    data: {
        labels: ["Simple", "Cached", "Cached + Docker"],
        datasets : [
            {
                label: "Pipeline total elapsed time (s)",
                data: [228,174,166],
                "fill": false,
                "backgroundColor": [
                    "rgba(255, 99, 132, 0.2)",
                    "rgba(75, 192, 192, 0.2)",
                    "rgba(153, 102, 255, 0.2)",
                ],
                "borderColor": [
                    "rgb(255, 99, 132)",
                    "rgb(75, 192, 192)",
                    "rgb(153, 102, 255)",
                ],
                "borderWidth": 1
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            yAxes : [{
                "ticks" : {
                    "beginAtZero" : true
                }
            }]
        }
    }
});
new Chart( "test-results", {
    type: 'bar',
    data: {
        labels: ["Simple", "Cached", "Cached + Docker"],
        datasets : [
            {
                label: "Test job elapsed time (s)",
                data: [84,63,69],
                "fill": false,
                "backgroundColor": [
                    "rgba(255, 99, 132, 0.2)",
                    "rgba(75, 192, 192, 0.2)",
                    "rgba(153, 102, 255, 0.2)",
                ],
                "borderColor": [
                    "rgb(255, 99, 132)",
                    "rgb(75, 192, 192)",
                    "rgb(153, 102, 255)",
                ],
                "borderWidth": 1
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            yAxes : [{
                "ticks" : {
                    "beginAtZero" : true
                }
            }]
        }
    }
});
new Chart( "build-results", {
    type: 'bar',
    data: {
        labels: ["Simple", "Cached", "Cached + Docker"],
        datasets : [
            {
                label: "Build job elapsed time (s)",
                data: [86,57,62],
                "fill": false,
                "backgroundColor": [
                    "rgba(255, 99, 132, 0.2)",
                    "rgba(75, 192, 192, 0.2)",
                    "rgba(153, 102, 255, 0.2)",
                ],
                "borderColor": [
                    "rgb(255, 99, 132)",
                    "rgb(75, 192, 192)",
                    "rgb(153, 102, 255)",
                ],
                "borderWidth": 1                
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            yAxes : [{
                "ticks" : {
                    "beginAtZero" : true
                }
            }]
        }
    }
});
new Chart( "deploy-results", {
    type: 'bar',
    data: {
        labels: ["Simple", "Cached", "Cached + Docker"],
        datasets : [
            {
                label: "Deploy job elapsed time (s)",
                data: [57,56,35],
                "fill": false,
                "backgroundColor": [
                    "rgba(255, 99, 132, 0.2)",
                    "rgba(75, 192, 192, 0.2)",
                    "rgba(153, 102, 255, 0.2)",
                ],
                "borderColor": [
                    "rgb(255, 99, 132)",
                    "rgb(75, 192, 192)",
                    "rgb(153, 102, 255)",
                ],
                "borderWidth": 1                
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            yAxes : [{
                "ticks" : {
                    "beginAtZero" : true
                }
            }]
        }
    }
});

</script> </div> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2"> 2025 Adrian Galera
</footer> </main>    </body> </html> <script type="module">const t=()=>{function r(o,a){o.forEach(s=>{const e=document.querySelector(`aside a[href="#${s.target.id}"]`);s.isIntersecting?(e?.classList.remove("bg-slate-200","dark:bg-slate-800"),e?.classList.add("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200")):(e?.classList.add("bg-slate-200","dark:bg-slate-800"),e?.classList.remove("bg-indigo-600","dark:bg-indigo-700","text-white","font-bold","transition-colors","duration-200"))})}const i=document.querySelectorAll("div.prose h1, div.prose h2, div.prose h3, div.prose h4, div.prose h5, div.prose h6"),n={root:null,rootMargin:" 15% 0px 0% 0px ",threshold:1},d=new IntersectionObserver(r,n);i.forEach(o=>{d.observe(o)})};t();document.addEventListener("astro:after-swap",t);</script>