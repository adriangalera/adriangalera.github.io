<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"> <!-- Global Metadata --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <meta name="generator" content="Astro v4.0.8"> <!-- Canonical URL --> <link rel="canonical" href="https://www.agalera.eu/creating-a-geolocation-enabled-wordpress-site-with-docker-compose-and-leaflet/"> <!-- SEO --> <meta name="title" content="Creating a Geolocation-Enabled WordPress Site with Docker Compose and Leaflet • agalera.eu"> <meta name="description" content="In this tutorial, we’ll build a geolocation-enabled WordPress site using Docker Compose. Our setup will include a custom &#34;piulada&#34; category, where each post contains latitude and longitude metadata. We'll also create a custom page that displays these posts on a map with markers, each linking to the individual post."> <meta name="author" content="Adrian Galera"> <!-- Open Graph / Facebook --> <meta property="og:type" content="article"> <meta property="og:url" content="https://www.agalera.eu/creating-a-geolocation-enabled-wordpress-site-with-docker-compose-and-leaflet/"> <meta property="og:title" content="Creating a Geolocation-Enabled WordPress Site with Docker Compose and Leaflet"> <meta property="og:description" content="In this tutorial, we’ll build a geolocation-enabled WordPress site using Docker Compose. Our setup will include a custom &#34;piulada&#34; category, where each post contains latitude and longitude metadata. We'll also create a custom page that displays these posts on a map with markers, each linking to the individual post."> <meta property="og:image" content="https://www.agalera.eu/_astro/pexels-pixabay-38271.wqA4l6dX.jpg">  <meta property="article:author" content="Adrian Galera"> <meta property="article:published_time" content="2024-10-30T23:00:00.000Z">  <!-- Twitter --> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://www.agalera.eu/creating-a-geolocation-enabled-wordpress-site-with-docker-compose-and-leaflet/"> <meta property="twitter:title" content="Creating a Geolocation-Enabled WordPress Site with Docker Compose and Leaflet"> <meta property="twitter:description" content="In this tutorial, we’ll build a geolocation-enabled WordPress site using Docker Compose. Our setup will include a custom &#34;piulada&#34; category, where each post contains latitude and longitude metadata. We'll also create a custom page that displays these posts on a map with markers, each linking to the individual post."> <meta property="twitter:image" content="https://www.agalera.eu/_astro/pexels-pixabay-38271.wqA4l6dX.jpg"> <!-- RSS auto-discovery --> <link rel="alternate" type="application/rss+xml" title="agalera.eu" href="/rss.xml"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>  <!-- Primary Meta Tags --> <title>Creating a Geolocation-Enabled WordPress Site with Docker Compose and Leaflet • agalera.eu</title><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'dark' : 'light')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_slug_.3AapyeBs.css" /><script type="module" src="/_astro/hoisted.JAyXFufJ.js"></script></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-8 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-4 md:p-0"> <a href="https://github.com/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://www.linkedin.com/in/adriangalera" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg> </span>  </a><a href="https://www.agalera.eu/cv" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="CV">  <span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-file-cv" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14 3v4a1 1 0 0 0 1 1h4"></path> <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"></path> <path d="M11 12.5a1.5 1.5 0 0 0 -3 0v3a1.5 1.5 0 0 0 3 0"></path> <path d="M13 11l1.5 6l1.5 -6"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header>   <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2024-10-30T23:00:00.000Z"> Oct 31, 2024 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 4 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Creating a Geolocation-Enabled WordPress Site with Docker Compose and Leaflet </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/bash" aria-label="bash"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> bash </span> </a><a href="/tags/php" aria-label="php"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> php </span> </a><a href="/tags/wordpress" aria-label="wordpress"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> wordpress </span> </a><a href="/tags/docker" aria-label="docker"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> docker </span> </a> </div> </header> <img src="/_astro/pexels-pixabay-38271.wqA4l6dX_8YT7x.jpg" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Creating a Geolocation-Enabled WordPress Site with Docker Compose and Leaflet" width="1000" height="500" decoding="async"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://www.agalera.eu/creating-a-geolocation-enabled-wordpress-site-with-docker-compose-and-leaflet/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://www.agalera.eu/creating-a-geolocation-enabled-wordpress-site-with-docker-compose-and-leaflet/" aria-label="Share on LinkedIn"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path> <path d="M8 11l0 5"></path> <path d="M8 8l0 .01"></path> <path d="M12 16l0 -5"></path> <path d="M16 16v-3a2 2 0 0 0 -4 0"></path> </svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <h2 class="font-bold mb-3 text-2xl dark:text-white">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#project-overview" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Project Overview </a>  </li><li class="flex flex-col"> <a href="#prerequisites" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Prerequisites </a>  </li><li class="flex flex-col"> <a href="#project-structure" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Project Structure </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#docker-composeyml" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> docker-compose.yml </a>  </li><li class="flex flex-col"> <a href="#custom-functionsadd-locationmapphp" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> custom-functions/add-location.map.php </a>  </li><li class="flex flex-col"> <a href="#custom-functionsadd-locationmapphp-1" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> custom-functions/add-location.map.php </a>  </li><li class="flex flex-col"> <a href="#wp-post-installation-scriptsh" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> wp-post-installation-script.sh </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#summary" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Summary </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <h2 id="project-overview">Project Overview</h2>
<p>Using Docker Compose, we’ll spin up a WordPress and MySQL environment. A custom post-installation script will automatically create the “piulada” category and populate posts with latitude and longitude fields. Then, with a custom page template, we’ll visualize these posts on a map using Leaflet.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before we start, ensure you have:</p>
<ul>
<li>Docker installed on your machine</li>
<li>Docker Compose installed</li>
</ul>
<h2 id="project-structure">Project Structure</h2>
<p>To keep things organized, we’ll set up our project structure as follows:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span>├── Makefile</span></span>
<span class="line"><span>├── README.md</span></span>
<span class="line"><span>├── custom-functions</span></span>
<span class="line"><span>│   ├── add-location.map.php</span></span>
<span class="line"><span>│   └── install.sh</span></span>
<span class="line"><span>├── docker-compose.yml</span></span>
<span class="line"><span>└── wp-post-installation-script.sh</span></span></code></pre>
<p>Now, let’s go through each file.</p>
<h3 id="docker-composeyml">docker-compose.yml</h3>
<p>The docker-compose.yml file configures two services:</p>
<ul>
<li>wordpress: Our WordPress application, using a custom Dockerfile.</li>
<li>db: A MySQL database.</li>
</ul>
<p>This file also mounts persistent volumes for both WordPress and MySQL data.</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F07178">services</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  db</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    image</span><span style="color:#89DDFF">:</span><span style="color:#F07178"> mysql</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 5.7</span></span>
<span class="line"><span style="color:#F07178">    container_name</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wordpress-db</span></span>
<span class="line"><span style="color:#F07178">    environment</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">      MYSQL_DATABASE</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wordpress</span></span>
<span class="line"><span style="color:#F07178">      MYSQL_USER</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wp_user</span></span>
<span class="line"><span style="color:#F07178">      MYSQL_PASSWORD</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wp_password</span></span>
<span class="line"><span style="color:#F07178">      MYSQL_ROOT_PASSWORD</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> root_password</span></span>
<span class="line"><span style="color:#F07178">    volumes</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#F07178"> mysql_data</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> /var/lib/mysql</span></span>
<span class="line"><span style="color:#F07178">    platform</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#C3E88D">      linux/amd64</span></span>
<span class="line"><span style="color:#F07178">    healthcheck</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">      test</span><span style="color:#89DDFF">:</span><span style="color:#89DDFF"> [</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">CMD</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">mysqladmin</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">ping</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">-h</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">localhost</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">]</span></span>
<span class="line"><span style="color:#F07178">      timeout</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> 5s</span></span>
<span class="line"><span style="color:#F07178">      retries</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">  wordpress</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">    image</span><span style="color:#89DDFF">:</span><span style="color:#F07178"> wordpress</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> latest</span></span>
<span class="line"><span style="color:#F07178">    container_name</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wordpress</span></span>
<span class="line"><span style="color:#F07178">    depends_on</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">      db</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">        condition</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> service_healthy</span></span>
<span class="line"><span style="color:#F07178">    environment</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">      WORDPRESS_DB_HOST</span><span style="color:#89DDFF">:</span><span style="color:#F07178"> db</span><span style="color:#89DDFF">:</span><span style="color:#F78C6C"> 3306</span></span>
<span class="line"><span style="color:#F07178">      WORDPRESS_DB_NAME</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wordpress</span></span>
<span class="line"><span style="color:#F07178">      WORDPRESS_DB_USER</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wp_user</span></span>
<span class="line"><span style="color:#F07178">      WORDPRESS_DB_PASSWORD</span><span style="color:#89DDFF">:</span><span style="color:#C3E88D"> wp_password</span></span>
<span class="line"><span style="color:#F07178">    volumes</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> wp:/var/www/html</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> ./plugins:/plugins</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#C3E88D"> ./custom-functions:/custom-functions</span></span>
<span class="line"><span style="color:#F07178">    ports</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#89DDFF">      -</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">8080:80</span><span style="color:#89DDFF">"</span></span>
<span class="line"><span style="color:#F07178">    platform</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#C3E88D">      linux / amd64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178">volumes</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  mysql_data</span><span style="color:#89DDFF">:</span></span>
<span class="line"><span style="color:#F07178">  wp</span><span style="color:#89DDFF">:</span></span>
<span class="line"></span></code></pre>
<h3 id="custom-functionsadd-locationmapphp">custom-functions/add-location.map.php</h3>
<p>This file contains the PHP code that queries the post to find the ones that have the lat and lng fields. Once retrieved it iterates over them and create markers in a leaflet map. It also initializes the required scripts:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> enqueue_leaflet_scripts</span><span style="color:#89DDFF">()</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#82AAFF">    wp_enqueue_style</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">leaflet-css</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">https://unpkg.com/leaflet@1.7.1/dist/leaflet.css</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">);</span></span>
<span class="line"><span style="color:#82AAFF">    wp_enqueue_script</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">leaflet-js</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">https://unpkg.com/leaflet@1.7.1/dist/leaflet.js</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> [],</span><span style="color:#89DDFF"> null,</span><span style="color:#89DDFF"> true);</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span>
<span class="line"><span style="color:#82AAFF">add_action</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">wp_enqueue_scripts</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">enqueue_leaflet_scripts</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> add_map_with_post_markers</span><span style="color:#89DDFF">()</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">    // Start building the output in a variable</span></span>
<span class="line"><span style="color:#89DDFF">    $</span><span style="color:#BABED8">output </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> ''</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">    $</span><span style="color:#BABED8">args </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> array</span><span style="color:#89DDFF">(</span></span>
<span class="line"><span style="color:#89DDFF">        '</span><span style="color:#C3E88D">post_type</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF"> =></span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">post</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">        '</span><span style="color:#C3E88D">meta_query</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF"> =></span><span style="color:#82AAFF"> array</span><span style="color:#89DDFF">(</span></span>
<span class="line"><span style="color:#82AAFF">            array</span><span style="color:#89DDFF">(</span></span>
<span class="line"><span style="color:#89DDFF">                '</span><span style="color:#C3E88D">key</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF"> =></span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">lat</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">                '</span><span style="color:#C3E88D">compare</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF"> =></span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">EXISTS</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">            ),</span></span>
<span class="line"><span style="color:#82AAFF">            array</span><span style="color:#89DDFF">(</span></span>
<span class="line"><span style="color:#89DDFF">                '</span><span style="color:#C3E88D">key</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF"> =></span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">lng</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">                '</span><span style="color:#C3E88D">compare</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF"> =></span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">EXISTS</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">            )</span></span>
<span class="line"><span style="color:#89DDFF">        )</span></span>
<span class="line"><span style="color:#89DDFF">    );</span></span>
<span class="line"><span style="color:#89DDFF">    $</span><span style="color:#BABED8">query </span><span style="color:#89DDFF">=</span><span style="color:#F78C6C"> new</span><span style="color:#FFCB6B"> WP_Query</span><span style="color:#89DDFF">($</span><span style="color:#BABED8">args</span><span style="color:#89DDFF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    if</span><span style="color:#89DDFF"> ($</span><span style="color:#BABED8">query</span><span style="color:#89DDFF">-></span><span style="color:#82AAFF">have_posts</span><span style="color:#89DDFF">())</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF">        $</span><span style="color:#BABED8">output </span><span style="color:#89DDFF">.=</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">&#x3C;div id="map" style="height: 500px; width: 100%;">&#x3C;/div></span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">        $</span><span style="color:#BABED8">output </span><span style="color:#89DDFF">.=</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">&#x3C;script type="text/javascript"></span></span>
<span class="line"><span style="color:#C3E88D">                document.addEventListener("DOMContentLoaded", function() {</span></span>
<span class="line"><span style="color:#C3E88D">                    var map = L.map("map").setView([0, 0], 2);</span></span>
<span class="line"><span style="color:#C3E88D">                    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {</span></span>
<span class="line"><span style="color:#C3E88D">                        maxZoom: 19,</span></span>
<span class="line"><span style="color:#C3E88D">                        attribution: "© OpenStreetMap"</span></span>
<span class="line"><span style="color:#C3E88D">                    }).addTo(map);</span></span>
<span class="line"><span style="color:#89DDFF">        '</span><span style="color:#89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">        // Add each post marker</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">        while</span><span style="color:#89DDFF"> ($</span><span style="color:#BABED8">query</span><span style="color:#89DDFF">-></span><span style="color:#82AAFF">have_posts</span><span style="color:#89DDFF">())</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF">            $</span><span style="color:#BABED8">query</span><span style="color:#89DDFF">-></span><span style="color:#82AAFF">the_post</span><span style="color:#89DDFF">();</span></span>
<span class="line"><span style="color:#89DDFF">            $</span><span style="color:#BABED8">lat </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> get_post_meta</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">get_the_ID</span><span style="color:#89DDFF">(),</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">lat</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> true);</span></span>
<span class="line"><span style="color:#89DDFF">            $</span><span style="color:#BABED8">lng </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> get_post_meta</span><span style="color:#89DDFF">(</span><span style="color:#82AAFF">get_the_ID</span><span style="color:#89DDFF">(),</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">lng</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> true);</span></span>
<span class="line"><span style="color:#89DDFF">            $</span><span style="color:#BABED8">title </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> get_the_title</span><span style="color:#89DDFF">();</span></span>
<span class="line"><span style="color:#89DDFF">            $</span><span style="color:#BABED8">url </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> get_permalink</span><span style="color:#89DDFF">();</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">            if</span><span style="color:#89DDFF"> ($</span><span style="color:#BABED8">lat </span><span style="color:#89DDFF">&#x26;&#x26;</span><span style="color:#89DDFF"> $</span><span style="color:#BABED8">lng</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF">                $</span><span style="color:#BABED8">output </span><span style="color:#89DDFF">.=</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">L.marker([</span><span style="color:#89DDFF">$</span><span style="color:#BABED8">lat</span><span style="color:#C3E88D">, </span><span style="color:#89DDFF">$</span><span style="color:#BABED8">lng</span><span style="color:#C3E88D">]).addTo(map)</span></span>
<span class="line"><span style="color:#C3E88D">                            .bindPopup('&#x3C;a href=</span><span style="color:#BABED8">\"</span><span style="color:#89DDFF">$</span><span style="color:#BABED8">url\"</span><span style="color:#C3E88D">></span><span style="color:#89DDFF">$</span><span style="color:#BABED8">title</span><span style="color:#C3E88D">&#x3C;/a>');</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">            }</span></span>
<span class="line"><span style="color:#89DDFF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF">        $</span><span style="color:#BABED8">output </span><span style="color:#89DDFF">.=</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">   });</span></span>
<span class="line"><span style="color:#C3E88D">            &#x3C;/script></span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">        wp_reset_postdata</span><span style="color:#89DDFF">();</span></span>
<span class="line"><span style="color:#89DDFF">    }</span><span style="color:#89DDFF;font-style:italic"> else</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF">        $</span><span style="color:#BABED8">output </span><span style="color:#89DDFF">.=</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">No posts found with coordinates.</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">    // Return the output so it appears in the right place</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    return</span><span style="color:#89DDFF"> $</span><span style="color:#BABED8">output</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span>
<span class="line"><span style="color:#82AAFF">add_shortcode</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">map_with_markers</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">add_map_with_post_markers</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">);</span></span>
<span class="line"></span></code></pre>
<p>All the logic to create the map displaying the post is handled here. It is creating a short code [map_with_markers] that will embed the map in the page where the user wants to use it.</p>
<h3 id="custom-functionsadd-locationmapphp-1">custom-functions/add-location.map.php</h3>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic">#!/bin/bash</span></span>
<span class="line"><span style="color:#FFCB6B">cat</span><span style="color:#C3E88D"> /custom-functions/add-location.map.php</span><span style="color:#89DDFF"> >></span><span style="color:#C3E88D"> /var/www/html/wp-content/themes/twentytwentyfour/functions.php</span></span></code></pre>
<p>Very hacky way of installing our customer logic into the default wordpress theme.</p>
<h3 id="wp-post-installation-scriptsh">wp-post-installation-script.sh</h3>
<p>Handles all the automations thanks to wp-cli:</p>
<pre class="astro-code material-theme-palenight" style="background-color:#292D3E;color:#babed8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Wait until WordPress is accessible</span></span>
<span class="line"><span style="color:#82AAFF">echo</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">Waiting for WordPress to be available...</span><span style="color:#89DDFF">"</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">until</span><span style="color:#FFCB6B"> curl</span><span style="color:#C3E88D"> -s</span><span style="color:#C3E88D"> http://localhost:8080/wp-admin/install.php</span><span style="color:#89DDFF"> &#x26;></span><span style="color:#BABED8"> /dev/null</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">do</span></span>
<span class="line"><span style="color:#FFCB6B">  sleep</span><span style="color:#F78C6C"> 5</span></span>
<span class="line"><span style="color:#82AAFF">  echo</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">...</span><span style="color:#89DDFF">"</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">echo</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">WordPress is accessible, proceeding with setup...</span><span style="color:#89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Run WordPress CLI commands inside the container</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Install wp-cli</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> curl</span><span style="color:#C3E88D"> -O</span><span style="color:#C3E88D"> https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</span><span style="color:#89DDFF"> &#x26;&#x26;</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> chmod</span><span style="color:#C3E88D"> +x</span><span style="color:#C3E88D"> wp-cli.phar</span><span style="color:#89DDFF"> &#x26;&#x26;</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> mv</span><span style="color:#C3E88D"> wp-cli.phar</span><span style="color:#C3E88D"> /usr/local/bin/wp</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Install wordpress with the specified user</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> core</span><span style="color:#C3E88D"> install</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --url=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">http://localhost:8080</span><span style="color:#89DDFF">"</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --title=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">My WordPress Site</span><span style="color:#89DDFF">"</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --admin_user=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">test</span><span style="color:#89DDFF">"</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --admin_password=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">test</span><span style="color:#89DDFF">"</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --admin_email=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">test@test.com</span><span style="color:#89DDFF">"</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --skip-email</span><span style="color:#BABED8"> \</span></span>
<span class="line"><span style="color:#C3E88D">  --allow-root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Append custom code into functions.php</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> /custom-functions/install.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Create post category</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> term</span><span style="color:#C3E88D"> create</span><span style="color:#C3E88D"> category</span><span style="color:#C3E88D"> piulada</span><span style="color:#C3E88D"> --allow-root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Create some posts with lat,lng fields</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> post</span><span style="color:#C3E88D"> create</span><span style="color:#C3E88D"> --allow-root</span><span style="color:#C3E88D"> --post_type=post</span><span style="color:#C3E88D"> --post_status=publish</span><span style="color:#C3E88D"> --post_title=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Balandrau</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D"> --post_content=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Balandrau</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --post_category=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">piulada</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --meta_input=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">{"lat":"42.369949953134366","lng":"2.2196442967547165"}</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> post</span><span style="color:#C3E88D"> create</span><span style="color:#C3E88D"> --allow-root</span><span style="color:#C3E88D"> --post_type=post</span><span style="color:#C3E88D"> --post_status=publish</span><span style="color:#C3E88D"> --post_title=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">Aneto</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D"> --post_content=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Aneto</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --post_category=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">piulada</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --meta_input=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">{"lat":"42.63089966977185","lng":"0.656174006128023"}</span><span style="color:#89DDFF">'</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> post</span><span style="color:#C3E88D"> create</span><span style="color:#C3E88D"> --allow-root</span><span style="color:#C3E88D"> --post_type=post</span><span style="color:#C3E88D"> --post_status=publish</span><span style="color:#C3E88D"> --post_title=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Pica d'Estats</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --post_content=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Pica d'Estats</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --post_category=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">piulada</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --meta_input=</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">{"lat":"42.66689037852365","lng":"1.3979348714672448"}</span><span style="color:#89DDFF">'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Create the page that displays the piulades</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> post</span><span style="color:#C3E88D"> create</span><span style="color:#C3E88D"> --allow-root</span><span style="color:#C3E88D"> --post_type=page</span><span style="color:#C3E88D"> --post_status=publish</span><span style="color:#C3E88D"> --post_title=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">Totes les piulades</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D"> --post_content=</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">[map_with_markers]</span><span style="color:#89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Install the advanced custom fields.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># This is not strictly required to prove the feature, it is necessary so that normal users</span></span>
<span class="line"><span style="color:#676E95;font-style:italic"># can see the lat,lng metadata fields in the post</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> plugin</span><span style="color:#C3E88D"> install</span><span style="color:#C3E88D"> /plugins/advanced-custom-fields.zip</span><span style="color:#C3E88D"> --activate</span><span style="color:#C3E88D"> --allow-root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic"># Make our map page to the frontpage</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> option</span><span style="color:#C3E88D"> update</span><span style="color:#C3E88D"> show_on_front</span><span style="color:#89DDFF"> '</span><span style="color:#C3E88D">page</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D"> --allow-root</span></span>
<span class="line"><span style="color:#FFCB6B">docker</span><span style="color:#C3E88D"> exec</span><span style="color:#C3E88D"> wordpress</span><span style="color:#C3E88D"> wp</span><span style="color:#C3E88D"> option</span><span style="color:#C3E88D"> update</span><span style="color:#C3E88D"> page_on_front</span><span style="color:#F78C6C"> 7</span><span style="color:#C3E88D"> --allow-root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF">echo</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">WordPress setup completed successfully! You can find the page here: http://localhost:8080</span><span style="color:#89DDFF">"</span></span></code></pre>
<h2 id="summary">Summary</h2>
<p>With this setup, we have a WordPress site powered by Docker Compose, MySQL, and a custom map template that uses Leaflet. The “piulada” category allows users to add geolocated posts, displayed interactively on an OpenStreetMap map. This setup can be expanded in many ways, such as enabling users to input their own geolocation data for each post.</p>
<p>Let me know if you found this useful, or if you have any questions about expanding this project!</p> </div> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2"> 2025 Adrian Galera
</footer> </main>    </body> </html> 